---
{"dg-publish":true,"permalink":"/1 Stories of Bizzo's Life/5 量子科学和量子技术/33 量子因果结构/","tags":["不定因果与因果结构"]}
---



> [!quote] 
>  Young man, in mathematics you don’t understand things. You just get used to them.
>    ——John von Neumann
>   以后种种譬如往日死，从前种种譬如来日生。
{ #w52fx1}


    
> [!abstract] Contents
> - 过程矩阵

## 引入

参考[[ball2017HowQuantumTrickery\|ball2017HowQuantumTrickery]]。在日常生活的经验中，任何事件的发生都有确定的因果顺序，穿上鞋子之前我一定先穿上了袜子。即便在正统的量子力学中，我们也完整地继承了牛顿时空观，例如在纠缠粒子对的测量实验中，我们仍然假设$B$观察到的效应发生在$A$进行测量之后，$A$不可能对她测量之前的物理状态产生影响。然而人们发现量子力学可能比原来所认识到的更加奇怪，两个事件的发生可能可以没有确定的因果关系甚至没有确定的时间顺序，量子信道的不同发生顺序、演化方向可以被相干地叠加，分别对应量子开关和量子时间翻转[[stromberg2024ExperimentalSuperpositionQuantum\|stromberg2024ExperimentalSuperpositionQuantum]]，这两个违反因果顺序的现象都已经在实验上被实现了。在具有不定因果的实验情景下谈论哪件事情是原因、或者哪件事情发生在前是没有意义的。

因果关系本质上就是关于事物在时间和空间之间相互影响关系，所以新的因果理论有助于量子力学和相对论的融合。我们需要更加深入地思考和研究量子因果结构，构建更加完善和激进的因果理论来解释这些奇怪的现象。与此同时，操纵不定因果将帮助我们在加速量子计算、提高精密测量精度方面更进一步，不定因果关系在量子通信、反转量子动力学、量子热力学方面都有应用\footnote{前面所有这些应用，参考[[antesberger2024HigherOrderProcessMatrix\|antesberger2024HigherOrderProcessMatrix]]的引言部分。}。

探索不定因果结构之前、我们先要对经典和量子因果结构有一定的了解。首先需要辨析因果和关联这两个概念，在本章中，关联意味着因果，无因果意味着无关联，因为我们需要用因果关系来解释这些个关联。导致关联的因果可能是直接或非直接直接的，对两个事件的关联存在5中基本的因果解释{（[[allen2017QuantumCommonCauses\|allen2017QuantumCommonCauses]] Sec.II.A）}，这一因果解释被称为Reichenbach(莱辛巴赫)原理[[reichenbach1991DirectionTime\|reichenbach1991DirectionTime]]，这一原理是经典因果结果、经典因果推导的核心，被总结为定理{（[[allen2017QuantumCommonCauses\|allen2017QuantumCommonCauses]] Th.1）}。在量子理论中，这一原理将变得更加复杂，仍然以Bell检验为例，两个测量结果的相关性违反Bell不等式，不能用共同的原因来解释。用经典因果模型来解释Bell检验需要引入超光速等“微调”[[allen2017QuantumCommonCauses\|allen2017QuantumCommonCauses]]。量子因果模型参考[[allen2017QuantumCommonCauses,lorenz2020QuantumCausalStructure\|allen2017QuantumCommonCauses,lorenz2020QuantumCausalStructure]]等。

经过对不定因果过程的不断研究，产生了许多有用的物理概念，帮我们更精细地对不定因果现象进行分类和刻画
\begin{itemize}
    \item 固定因果顺序的过程。量子梳。各个观测者有预先确定的全序，时间轴上靠后的人不能向靠前的人通信。
    \item 因果可分过程。对两体过程来说，因果可分过程就是两种可能的顺序过程矩阵的经典线性叠加(可能超过两项)，已经证明可幺正拓展的两体过程都是因果可分的[[barrett2021CyclicQuantumCausal\|barrett2021CyclicQuantumCausal]]。对于多体过程，参见[[wechs2019DefinitionCharacterisationMultipartite\|wechs2019DefinitionCharacterisationMultipartite]]。
    \item 因果不可分过程。不是因果可分的过程。例如(三体（[[ognyanoreshkov2019TimedelocalizedQuantumSubsystems\|ognyanoreshkov2019TimedelocalizedQuantumSubsystems]] (10)）或四体版本)量子开关（量子开关可以被视为四节点幺正过程，因此它作为两节点过程是可幺正拓展的，进而是因果可分的，这与三体或者四题量子开关不可分之间并不矛盾）。
    \item 非因果过程。违反因果不等式的过程。当前的对于不定因果过程能否实现的争议主要集中在那些非因果的过程，有人提出了用时间非局域的过程来在实验上“实现”那些非因果的过程，已经证明存在三体非因果过程，能够用时间非局域子系统的方式来实现[[wechs2023ExistenceProcessesViolating\|wechs2023ExistenceProcessesViolating]]。**时间非局域子系统**(delocalised)：对于多个不同时刻的Hilbert空间的张量积$\mathsf{H}\equiv \bigotimes \mathsf{H}_{t_i}$，对$\mathsf{H}$选取新的张量积结构，如果新的张量积因子(子系统)没有确定的时间，则称其为时间非局域子系统。
    \item 可幺正拓展的过程，可以通过加入辅助系统，使得过程矩阵拓展为幺正信道的过程。这些过程被认为是能够在实验上实现的必要条件，因为它保持了量子操作的可逆性，也就是说，当你在每个插槽插入幺正信道的时候，可幺正拓展的过程会返回给你一个幺正信道[[wechs2023ExistenceProcessesViolating\|wechs2023ExistenceProcessesViolating]]。
    \item \includegraphics[width=0.6\textwidth]{image//2025-05-15-16-16-29.png}
\end{itemize}

部分定理和命题使用两种不同的蔡氏矩阵的定义，使得节点的排序发生一些变化，但实际上只要对每个Hilbert空间进行命名，其排序并不重要，不同的顺序之间只相差一个局域幺正变换（与symmetric monoidal category、braided monoidal category的关系？）。

## 高阶量子映射与过程矩阵
\myemphg{问题}：与量子张量网络的关系是什么？张量网络通常是指量子梳，具有确定因果顺序的(一种没有完全确定因果结构的约束，可以用投影算符刻画)，而过程矩阵通常不需要具有确定的因果结构。

通常使用[[链积\|链积]]用于缩并过程矩阵。

> [!definition] [[量子超信道\|量子超信道]] (superchannel) 和[[过程矩阵\|过程矩阵]] (process matrix)
> \label{def:superchannelprocessmat}
>
> 设
> $$
> f:\Pi_{i=1}^nB(B(A_i^\mathrm{in}),B(A_i^\mathrm{out}))\rightarrow B(B(P),B(F)),\quad (\mathcal{E}_1,\ldots,\mathcal{E}_n)\mapsto \mathcal{M}
> $$
> 是多线性映射。  
> 
> 利用多线性映射和张量积上线性映射的自然一一对应关系（张量积的泛性质），得到线性映射
> $$
> f^{(0)}:\bigotimes_{i=1}^n B(B(A_i^\mathrm{in}),B(A_i^\mathrm{out}))\rightarrow B(B(P),B(F)),\quad 
> \mathcal{E}_1\otimes \ldots\otimes \mathcal{E}_n\mapsto \mathcal{M}
> $$
>
> 将 $f$ 视为蔡氏矩阵层面上的映射，得到
> $$
> f^{(1)}\equiv \mathsf{CJ} \circ f^{(0)} \circ \mathsf{CJ}^{-1} :
> B\!\left(\bigotimes_{i=1}^n A_i^{\text{out}} \otimes A_i^{\text{in*}}\right)\rightarrow B(F \otimes P^*), \quad
> \rho^{\mathcal{E}_1}\otimes \ldots\otimes \rho^{\mathcal{E}_n}\mapsto \rho^\mathcal{M}
> $$
>
> $f^{(1)}$ 的蔡氏矩阵为
> $$
> f^{(2)}= \mathsf{CJ}(f^{(1)}) \in B\!\left(F \otimes P^* \otimes \bigotimes_{i=1}^n A_i^{\text{out*}} \otimes A_i^{\text{in}}\right)
> $$
>
> 下列条件等价：
> 1. $f^{(0)}$ 是 **CCP** (completely completely positive)，即 $f^{(0)} \otimes \mathrm{id}$ 保持全正性。  
> 2. $f^{(1)}$ 是 **CP** (completely positive)，即 $f^{(1)}\otimes \mathrm{id}$ 是正的。  
> 3. $f^{(2)}$ 是 **P** (positive) 的。  
>
> 上述任意一点成立时，称 $f$ 是（不一定保迹的） **超信道** (superchannel)，称 $f^{(2)}$ 为 $f$ 的 **过程矩阵** (process matrix)。



> [!proof]
> - 两次使用蔡氏定理\ref{th:choistheorem}。


- 使用范畴论的语言，无论是量子态、量子信道还是超信道都可以被视为态射。
- 关于超信道的更多性质，参见[[Fundamental Limitations on the Recoverability of Quantum Processes\|文献]]和 [1808.02607](https://arxiv.org/pdf/1808.02607) 
-  [[量子超信道\|量子超信道]]中的定义添加了保保迹性，即保TP。

定义投影超信道。在考虑量子过程矩阵的情境下，下面的定义是常用的。
> [!definition] 算符系统上的投影{{\cite[Def.3.2.7
> - {hoffreumon2023CharacterizationHigherorderQuantum}}}]\label{def:projectchannelof}
>
>   设$>   \mathcal{P}_A \in B\left(B\left(\mathsf{H}^A\right), B\left(\mathsf{H}^A\right)\right)
>$，如果$\mathcal{P}_A$满足
>
$$
\begin{gathered}
\mathcal{P}_A \circ \mathcal{P}_A=\mathcal{P}_A ; \\
\mathcal{P}_A^\dagger=\mathcal{P}_A ; \\
\mathcal{P}_A \circ \dagger \circ \mathcal{P}_A=\dagger \circ \mathcal{P}_A ; \\
\mathcal{P}_A \circ \mathcal{D}_A=\mathcal{D}_A,
\end{gathered}
$$
>   则称其为**算符系统上的投影**，其中$\mathcal{D}_A$是系统$A$上的完全退极化信道。

> [!note]
> - \myemph{问题}： $\mathcal{P}_A$是投到(某个？)算符系统上的投影操作。一定是全正的吗？

> [!definition] 完全退极化信道
> - \label{def:completelydepolarizing}
>   设线性映射$\mathcal{D}_A(\rho)\in B(B(\mathsf{H}^A),B(\mathsf{H}^A))$，**退极化信道**定义为
>
$$
\mathcal{D}_A\left(\rho\right)\equiv {}_A(\rho)\equiv \frac{\mathbb{I}_A}{d_A} \operatorname{tr}\left(\rho\right)
$$
>   有时将$\mathcal{D}_A(\cdot)$记为${}_A(\cdot)$，这个记号来自[[araujo2015WitnessingCausalNonseparability\|araujo2015WitnessingCausalNonseparability]]。

将超信道中的输出空间设为平凡的\footnote{又或者将$P$和$F$视为两个普通的节点}，即$P=F=\mathbb{C}$，就得到了过程矩阵的数学形式，可以认为一个量子过程由一些节点$\{A_i\}$构成，每个节点各有一个输入和输出空间，每个节点代表一个局域量子实验室[[araujo2015WitnessingCausalNonseparability\|araujo2015WitnessingCausalNonseparability]]，在数学上用一个仪器来表示，这些测量用仪器(定义\ref{def:instrument})表示。量子过程描述了发生在环境的、不受实验室控制的所有过程，它提供了从局部实验室对外部环境施加的干扰，也即测量结果，到概率分布的映射{（[[hoffreumon2023CharacterizationHigherorderQuantum\|hoffreumon2023CharacterizationHigherorderQuantum]] Sec.1.1）}。

在最典型的链式因果结构中，过程矩阵描述了从某个系统的初态出发，经历一连串量子节点和节点之间的量子测量的过程。量子过程矩阵给出了测量得到相应结果的概率，量子过程矩阵是量子态的推广，它将初态和节点之间的的信息包含在内，而概率公式是Born规则的推广。从这个角度看，过程矩阵是量子理论的高阶推广，更多关于量子态的高阶推广的内容参见{（[[hoffreumon2023CharacterizationHigherorderQuantum\|hoffreumon2023CharacterizationHigherorderQuantum]] Sec.3）}。这也说明了并非所有的超信道都是物理上可以实现的，合法的一个必要条件是满足概率归一化条件\footnote{对过程矩阵做概率的次归一化推广可以定义所谓的“概率过程矩阵”，参见[[wechs2021QuantumCircuitsClassical\|wechs2021QuantumCircuitsClassical]]。}。概率的归一化将量子过程限制到了正定矩阵空间的一个子空间上，回避了因果矛盾等问题，这启发了下面的定义。
> [!definition] 概率归一化的过程矩阵(算符){\cite[Def.3.7
> - {lorenz2020QuantumCausalStructure}}]\label{def:processmatrix}
>   设有一些节点$S=\{A_1,\ldots ,A_n\}$，和相应的Hilbert空间$A_i^\mathrm{in}\equiv \mathsf{H}_{A_i^\mathrm{in}}$，$A_i^\mathrm{out}\equiv\mathsf{H}_{A_i^\mathrm{out}}$。
>   设$\{\mathcal{E}^{k_{A_i}}: B\left( {A_i^{\text {in}}}\right) \rightarrow B\left(A_i^{ \text {out}}\right)\}$是节点$A_i$上的仪器(定义\ref{def:instrument})。
>   由于蔡氏矩阵存在两种不同的约定(参见定理\ref{th:cjinso}和命题\ref{prop:inverseofcj})，量子过程矩阵有两种不同的顺序的定义
>
> - 仪器的元素的转置的蔡氏矩阵为 $\mathcal{E}^{A_i}\equiv \sum_{k_{A_i}} \mathcal{E}^{k_{A_i}}$，$\tau_A^{k_A}\equiv \mathsf{CJ}(\mathcal{E}^{k_A})^\top=(\rho_{A^\mathrm{out}|A^{\mathrm{in}}}^{\mathcal{E}^{k_{A}}})^\top \in B({A^{\mathrm{out}*}}\otimes  {A^\mathrm{in}})$，类似地，仪器的转置的蔡氏矩阵为$\tau_A\equiv (\rho^{\mathcal{E}^A}_{A^\mathrm{out}|A^{\mathrm{in}}})^\top \in B\left( {A^{\mathrm{out}*}}\otimes  {A^\mathrm{in}}\right)$，
>
>   定义在节点上的**量子过程矩阵**是一个正定矩阵，
>
$$
\sigma_{A_1 \ldots A_n} \in B\left(\bigotimes_{i=n}^1 A_i^{{ \text {out}}*} \otimes  {A_i^{\text {in}}}\right)
\equiv B\left(\bigotimes_{i=n}^1 A_i^{{ \text {o*i}}} \right)
$$
>   且对任何给定的一族仪器$\{ \mathcal{E}^{A_i}\}$，满足概率归一化条件
>
$$
\sigma_{A_1 \ldots A_n}\star \bigotimes_{i= n}^1 \rho_{A_i^\mathrm{out}|A_i^{\mathrm{in}}}^{\mathcal{E}_A}\equiv \operatorname{tr}\left[\sigma_{A_1 \ldots A_n}\left(\tau_{A_n} \otimes \ldots \otimes \tau_{A_1}\right)\right]= 1
$$
>
>   eq-eq-normalofprocessmatrix-1
> - 仪器的元素的转置的蔡氏矩阵为 $\mathcal{E}^{A_i}\equiv \sum_{k_{A_i}} \mathcal{E}^{k_{A_i}}$，$\tau_A^{k_A}\equiv \mathsf{CJ}(\mathcal{E}^{k_A})^\top= (\rho_{A^\mathrm{out}|A^{\mathrm{in}}}^{\mathcal{E}^{k_{A}}})^\top \in B( {A^\mathrm{in}} \otimes  {A^{\mathrm{out}*}})$，类似地，仪器的转置的蔡氏矩阵为$\tau_A\equiv (\rho^{\mathcal{E}^A}_{A^\mathrm{out}|A^{\mathrm{in}}})^\top \in B( {A^\mathrm{in}} \otimes  {A^{\mathrm{out}*}})$，
>
>   定义在节点上的**量子过程矩阵**是一个正定矩阵，
>
$$\sigma_{A_1 \ldots A_n}\star \bigotimes_{i= 1}^n \rho_{A_i^\mathrm{out}|A_i^{\mathrm{in}}}^{\mathcal{E}_A}\equiv \sigma_{A_1 \ldots A_n} \in B\left(\bigotimes_{i=1}^n A_i^{{\text {in}}} \otimes  {A_i^{\text {out}*}}\right)     \equiv B\left(\bigotimes_{i=1}^n A_i^{{ \text {io*}}} \right)$$
>   且对任何给定的一族仪器$\{ \mathcal{E}^{A_i}\}$，满足概率归一化条件
>
$$
\operatorname{tr}\left[\sigma_{A_1 \ldots A_n}\left(\tau_{A_1} \otimes \ldots \otimes \tau_{A_n}\right)\right]= 1
$$
>
>   eq-eq-normalofprocessmatrix-2
>
>   简记为$\mathrm{tr}(\sigma_S \tau_S)=1$。

> [!note]
> - 这里的约定 $\tau_A$ 的起点终点和 {（[[lorenz2020QuantumCausalStructure\|lorenz2020QuantumCausalStructure]] (3.6)）} 相反，我认为是他混淆了蔡氏矩阵的两种定义。  
>   实际上，当每个子系统都有恰当的标记的时候，顺序并不重要。通过加入合适的幺正变换，我们可以轻易地在不同的子系统排列顺序之间切换。  
>   顺序不重要这一点，恰好体现了 **不定因果顺序**。
>
> - 过程矩阵可以被视为 **高阶量子映射的蔡氏矩阵**。
>
> - **问题**：量子过程矩阵在何种意义下是全正的？  
>   除了作为信道 $\mathcal{P}:B(\bigotimes_i A_i^{\mathrm{out}} )\rightarrow B( \bigotimes_i A_i^{\mathrm{in}} )$？  
>   与 comb 的全正性进行比较？是否无论怎么划分空间、都能得到全正的映射？
>
> - **问题**：能否做进一步的推广，使得测量不是直积的形式？  
>   推广为拿两个过程做链积？  
>   这种推广已经被建立，被称为 **多轮过程矩阵** [[hoffreumon2021MultiroundProcessMatrix\|hoffreumon2021MultiroundProcessMatrix]]。  
>   多轮过程矩阵可以被视为特殊的过程矩阵，而过程矩阵也可以被视为特殊的多轮过程矩阵。  
>   更进一步的问题：如果观测者进行的多轮观测是所谓的经典控制的量子线路 QC-CC，多轮过程矩阵应该如何定义，又有怎样的等价刻画？
>
> - **问题**：过程矩阵谱分解可以得到 Kraus 算符。  
>   Kraus 算符受到的约束是怎样的？能否做类似定理 \ref{th:krausofcomb} 的推导？
>
> - 概率归一化的过程矩阵的定义体现了所谓的 **“无限制假设”** {（[[hoffreumon2023CharacterizationHigherorderQuantum\|hoffreumon2023CharacterizationHigherorderQuantum]] p.25）}（no-restriction）：  
>   一个过程矩阵是有效的，当且仅当对于试验者所有的干扰都给出合法的概率分布。  
>   与所谓的“鸭子测试”类似。


概率关于测量结果，即仪器中的元素，是线性函数，利用CJ同构，概率是关于仪器的元素的蔡氏矩阵的线性函数。由于通常只考虑仪器之间的凸线性叠加，所以线性和反线性没有区别。

使用第二种约定，从过程矩阵得到测量结果出现的概率的公式(推广的Born规则)是
$$
P\left(k_{A_1}, \ldots, k_{A_n}\right)=Pr\left(  \tau_{A_1}^{k_{A_1}}, \ldots, \tau_{A_n}^{k_{A_n}}\right)=\operatorname{tr}\left[\sigma_{A_1 \ldots A_n}\left(\tau_{A_1}^{k_{A_1}} \otimes \cdots \otimes \tau_{A_n}^{k_{A_n}}\right)\right]
$$
过程矩阵的正定性保证了概率都是正的，反之，如果要求对于任何蔡氏矩阵，概率都是正的，那么过程矩阵也是正的(待证)。

进一步的研究发现、可能并不是所有的概率归一化的过程都是合法的，我们还需要可逆性，这被归结为可幺正拓展性。

> [!definition] 量子过程的可幺正拓展性 Def.5 - [[barrett2021CyclicQuantumCausal\|barrett2021CyclicQuantumCausal]]
>   称量子过程 $\sigma_{A_1 \ldots A_n}$ **可幺正拓展**当且仅当存在幺正过程 $\sigma_{A_1 \ldots A_n P F}=$ $\rho_{A_1 \ldots A_n F \mid A_1 \ldots A_n P}^{\mathcal{U}}$ 使得   $\sigma_{A_1 \ldots A_n}=$ $\operatorname{tr}_{F P}\left[\sigma_{A_1 \ldots A_n P F} \tau_P\right]$ ，存在某个 $\tau_P \in B\left(\mathsf{H}_{P^{\text {out}}}^*\right)$。称过程 $\sigma_{A_1 \ldots A_n P F}$ 与 $\sigma_{A_1 \ldots A_n}$的**幺正拓展**。

> [!note]
> - \myemph{问题}：幺正拓展和线路实现的关系是？对于一个一般的量子过程，即便找到了幺正拓展，我（们）一般也不知道如何用量子线路来实现它。

> [!theorem] 两节点归一化过程的投影等价刻画
{ #th-th-normaltpprocessprojchar}

> - $\sigma \in B(A^\mathrm{i}\otimes A^\mathrm{o*}\otimes B^\mathrm{i}\otimes B^\mathrm{o*})$是一个满足归一化条件的过程矩阵当且仅当
>
$$
W \geqslant 0, \operatorname{tr} W=d_{A^\mathrm{o}} d_{B^\mathrm{o}}, \text { and } W=L_V(W)
$$
>   其中
>
$$
\begin{aligned}
L_V(W)  & ={ }_{A^\mathrm{o}} W+{ }_{B^\mathrm{o}} W-{ }_{A^\mathrm{o} B^\mathrm{o}} W-{ }_{B^\mathrm{i} B^\mathrm{o}} W+{ }_{A^\mathrm{o} B^\mathrm{i} B^\mathrm{o}} W-{ }_{A^\mathrm{i} A^\mathrm{o}} W+{ }_{A^\mathrm{i} A^\mathrm{o} B^\mathrm{o}} W
\end{aligned}
$$
>
>   eq-eq-2pointprocess

> [!proof]
> - 参见{（[[araujo2015WitnessingCausalNonseparability\|araujo2015WitnessingCausalNonseparability]] (B.20)）}。

> [!note]
> - 三节点以及$n$节点在[[araujo2015WitnessingCausalNonseparability\|araujo2015WitnessingCausalNonseparability]]中有相似的证明。

- 实际上$W$对应了一个从$A^oB^o$到$A^i B^i$的信道，即存在信道$\mathcal{W}:B(A^oB^o)\to B(A^i B^i)$，使得 $$W = \mathcal{I}\otimes \mathcal{W}(|\mathbb{I}\rangle\langle\mathbb{I}|)$$
- 这实际上要求$L_V$对应的子空间比$P = \mathcal{I}- \mathcal{D}_{A^iB^i}$对应的空间更小，即 
$$L_VP=L_V$$
上式是一个简单的代数计算，详见：重新投影刻画.nb
对命题\ref{prop:inverseofcj}中的过程矩阵的例子的记号稍加改动，我们有下面的例子。

> [!example] 测量-演化-测量的量子过程矩阵
> \label{ex:quantumprocess2}
>
> 超映射为
> $$
> (\cdot)\circ \mathcal{C}\circ (\cdot):(\mathcal{E}^{A_1},\mathcal{E}^{A_2})\mapsto \mathcal{E}^{A_2}\circ \mathcal{C}\circ \mathcal{E}^{A_1},
> $$ 
根据张量积的[[泛性质\|泛性质]]，对于任何在两个向量空间 $V \times W$ 上双线性的映射
$$
B: V \times W \rightarrow U
$$
都唯一存在的线性映射
$$
\widetilde{B}: V \otimes W \rightarrow U
$$
使得 $\widetilde{B}(v \otimes w)=B(v, w)$ 并对任意线性组合扩张成立。因此，只要你确定
$$
B(\mathcal{A}, \mathcal{B})=\mathcal{A C B}
$$
对于每个 $\mathcal{A}$ 和 $\mathcal{B}$ 关于各自线性（固定 $\mathcal{C}$ ），就必然存在唯一的线性算子 $\mathcal{L}_{\mathcal{C}}$ 在代数张量积上满足
$$
\mathcal{L}_{\mathcal{C}}(\mathcal{A} \otimes \mathcal{B})=\mathcal{A C B},
$$
并线性扩展到任意的 $\sum_i \mathcal{A}_i \otimes \mathcal{B}_i$ 。因此上述超映射等价于
$$(\cdot)\circ \mathcal{C}\circ (\cdot): \mathcal{M} = \sum_i \mathcal{A}_i\otimes \mathcal{B}_i\mapsto \sum_i \mathcal{A}_i\mathcal{C} \mathcal{B}_i$$
可以通过蔡氏矩阵显式地将$\mathcal{L}_\mathcal{C}$求出来。
下面回到过程矩阵相关的讨论。注意 $A_1$ 先于 $A_2$。现在假设$\mathcal{C}$是外界的过程，$A_1$和 $A_2$ 是两个局域是现实，下面利用复合信道的蔡氏矩阵公式来推导过程矩阵的表达式。 同样地，由于蔡氏矩阵存在两种不同的定义，例子也有两种不同的版本。
**版本一**  
设
$$
B\!\left(A_1^{\text{in}}\right) \xrightarrow{\mathcal{E}^{A_1}} B\!\left(A_1^{\text{out}}\right) 
\xrightarrow{\mathcal{C}} B\!\left(A_2^{\text{in}}\right) 
\xrightarrow{\mathcal{E}^{A_2}} B\!\left(A_2^{\text{out}}\right),
$$
则概率
$$
P(k_{A_1},k_{A_2})
=\mathrm{tr}\left(\mathcal{E}^{k_{A_2}}\circ \mathcal{C}\circ \mathcal{E}^{k_{A_1}}(\rho_{A_1^{\mathrm{in}}})\right)
=\mathrm{tr}\left( \sigma_{A_1A_2}\, \tau_{A_2}^{k_{A_2}}\otimes  \tau_{A_1}^{k_{A_1}} \right),
$$
其中
$$
\sigma _{A_1A_2}
=\mathbb{I}_{A_2^{\mathrm{out}*}}\otimes \mathsf{C}\otimes \rho_{A_1^\mathrm{in}}
=\mathbb{I}_{A_2^{\mathrm{out}*}}\otimes \rho^\mathcal{C}_{A_2^\mathrm{in}|A_1^\mathrm{out}}\otimes \rho_{A_1^\mathrm{in}}
\in B\!\left(A_2^{\text{out}*}\otimes A_2^{\text{in}}\otimes A_1^{\text{out}*}\otimes A_1^{\text{in}}\right).
$$

略去 $\mathrm{in}$、$\mathrm{out}$、单位阵和角标 $\mathcal{C}$，简记为
$$
\sigma_{A_1A_2}=\rho_{A_2|A_1}\rho_{A_1}.
$$
eq-eq-simplestcausalmodel


**版本二**  
设
$$
B\!\left(A_1^{\text{in}}\right) \xrightarrow{\mathcal{E}^{A_1}} B\!\left(A_1^{\text{out}}\right) 
\xrightarrow{\mathcal{C}} B\!\left(A_2^{\text{in}}\right) 
\xrightarrow{\mathcal{E}^{A_2}} B\!\left(A_2^{\text{out}}\right),
$$
则概率
$$
P(k_{A_1},k_{A_2})
=\mathrm{tr}\left(\mathcal{E}^{k_{A_2}}\circ \mathcal{C}\circ \mathcal{E}^{k_{A_1}}(\rho_{A_2^{\mathrm{in}}})\right)
=\mathrm{tr}\left( \sigma_{A_1A_2}\, \tau_{A_1}^{k_{A_1}}\otimes  \tau_{A_2}^{k_{A_2}} \right),
$$
其中
$$
\sigma _{A_1A_2}
=\rho_{A_1^\mathrm{in}}\otimes  \mathsf{C}\otimes\mathbb{I}_{A_2^{\mathrm{out}*}}
=\rho_{A_1^\mathrm{in}}\otimes  \rho^\mathcal{C}_{A_2^\mathrm{in}|A_1^\mathrm{out}}\otimes\mathbb{I}_{A_2^{\mathrm{out}*}}
\in B\!\left(A_1^{\text{in}}\otimes A_1^{\text{out}*}\otimes A_2^{\text{in}}\otimes A_2^{\text{out}*}\right).
$$

略去 $\mathrm{in}$、$\mathrm{out}$、单位阵和角标 $\mathcal{C}$，简记为
$$
\sigma_{A_1A_2}=\rho_{A_1}\rho_{A_2|A_1}.
$$

注意：无论何种记号，父节点总是出现在竖线的右侧（先），子节点总是出现在竖线的左侧（后）。  显然，两个因子都是对易的。


> [!example] Bell检验的过程矩阵
> 将 Bell 检验视为一个两节点过程，$A$ 和 $B$ 共享的量子态记为 $\rho^{AB}$，在数学上我们要找到
> $\sigma_{AB}\in B\!\left(A^{\text{in}}\otimes A^{\text{out}*}\otimes B^{\text{in}}\otimes B^{\text{out}*}\right)$ 满足
>
> $$
> \mathrm{tr}\!\big(\mathcal{A}\otimes \mathcal{B}(\rho^{AB})\big)
> =\mathrm{tr}\!\big(\sigma_{AB}\,\tau_{A}\otimes \tau_B\big)
> $$
>
> 其中 $\mathcal{A}$ 和 $\mathcal{B}$ 是任意全正映射（不必保迹），$\tau_A$ 和 $\tau_B$ 是相应蔡氏矩阵的转置。这实际上是在构造一个高阶映射
>
> $$
> \mathcal{L}: B(A^{\mathrm{i*}}\!\otimes A^{\mathrm{o}})\otimes B(B^{\mathrm{i*}}\!\otimes B^{\mathrm{o}})
> \rightarrow \mathbb{C},\quad
> \rho^\mathcal{A}_{A^{\mathrm{out}}|A^{\mathrm{in}}}\otimes \rho^\mathcal{B}_{B^{\mathrm{out}}|B^{\mathrm{in}}}
> \mapsto \mathrm{tr}\!\left(\mathsf{CJ}^{-1}(\rho^\mathcal{A})\otimes \mathsf{CJ}^{-1}(\rho^\mathcal{B})(\rho^{AB})\right)
> $$
>
> 的蔡氏矩阵。根据蔡氏矩阵的定义，
>
> $$
> \begin{aligned}
> \rho^\mathcal{L}
> &= (\mathcal{L}\otimes \mathbb{I})\!\left(|\mathbb{I}\rangle\langle\mathbb{I}|\right) \\
> &= \mathrm{tr}_{A^\mathrm{o}B^\mathrm{o}}\!\left(\mathsf{CJ}^{-1}\!\left(|ij\rangle\langle kl|\right)\!\otimes\!
> \mathsf{CJ}^{-1}\!\left(|pq\rangle\langle mn|\right)(\rho^{AB})\right)\,|ijkl\rangle\langle pqmn| \\
> &= \mathrm{tr}_{A^\mathrm{o}B^\mathrm{o}}\!\left(\mathsf{CJ}^{-1}\!\left(|ijkl\rangle\langle pqmn|\right)(\rho^{AB})\right)\,|ijkl\rangle\langle pqmn| \\
> &= \mathrm{tr}\!\left(\mathrm{tr}_{A^{\mathrm{i*}}B^{\mathrm{i*}}}\!\left(|ijkl\rangle\langle pqmn|\,\rho^{AB\top}\right)\right)\,|ijkl\rangle\langle pqmn| \\
> &= \mathrm{tr}_{A^{\mathrm{i*}}B^{\mathrm{i*}}}\!\left(|ij\rangle\langle pq|\,\rho^{AB\top}\right)\,|ij\rangle\langle pq|_{A^\mathrm{i*}B^\mathrm{i*}}\otimes \mathbb{I}_{A^\mathrm{o*}B^\mathrm{o*}} \\
> &= \rho^{AB}\otimes \mathbb{I} \;=\; \sigma_{AB}.
> \end{aligned}
> $$
>
> 注意：$\rho^{AB}$ 的转置是作用在系统 $A^{\mathrm{i*}}B^{\mathrm{i*}}$ 上；推导中用到了 $\mathsf{CJ}^{-1}$ 保持张量积的性质。相同的方法可用于量子开关（\switch）的过程矩阵推导。
>
> 将 Bell 检验过程视为一个四节点幺正过程（幺正性待证）：过去 $P$ 制备量子态，$A$、$B$ 执行测量，$F$ 将量子态舍弃，也可做类似推导。


利用过程矩阵的关于偏迹的性质，可以将过程矩阵本身视为某个信道的蔡氏矩阵。在式\eqref{eq:normalofprocessmatrix}中取$\tau_{A}=\tau_{A^{\mathrm{out}*}}\otimes \mathbb{I}_{A^\mathrm{in}}\in B\left( {A^{\mathrm{out}*}}\otimes  {A^\mathrm{in}}\right)$，则式\eqref{eq:normalofprocessmatrix}成为
$$
\mathrm{tr}_{\{A_i^\mathrm{out*}\}}\left(\mathrm{tr}_{\{A_i^\mathrm{in}\}}(\sigma_{A_1\ldots A_n}) \tau_{A_1^{\mathrm{out}*}}\otimes \cdots \otimes\tau_{A_n^{\mathrm{out}*}}\right)=1
$$
由$\tau_{A_i^{\mathrm{out}*}}$的任意性可知
$$
\mathrm{tr}_{\{{A_i^\mathrm{in}\}}}(\sigma_{A_1\ldots A_n})= \mathbb{I}_{A_1^{\mathrm{out}*}}\otimes \cdots \otimes \mathbb{I}_{A_n^{\mathrm{out}*}}
$$
由于过程矩阵是正定$\sigma_S\equiv \sigma_{A_1\ldots A_n}$的，所以存在一个信道$\mathcal{P}:B(\bigotimes_i A_i^{\mathrm{out}} )\rightarrow B( \bigotimes_i A_i^{\mathrm{in}} )$与$\sigma_S$对应，根据命题\ref{prop:inverseofcj}，
$$
\mathcal{P}(\rho_{A_i^\mathrm{out}\ldots A_n^\mathrm{out}})=\mathrm{tr}_{\{A_i^\mathrm{out*}\}}\left(\sigma_S \rho_{A_i^\mathrm{out}\ldots A_n^\mathrm{out}}^\top \right)
$$
此时我们可以将过程矩阵记为
$$
\sigma_{A_1\ldots A_n}=\rho^\mathcal{P}_{A_1^\mathrm{in}\ldots A_n^\mathrm{in}|A_1^\mathrm{out}\ldots A_n^\mathrm{out}}
$$
eq-eq-choiofsomechannelprocess

根据蔡氏矩阵的定义(定理\ref{th:cjinso})，将过程矩阵视为某个信道的蔡氏矩阵给出了计算过程矩阵的方法。


![2025-02-15-12-08-48.png](/img/user/2025-02-15-12-08-48.png)
> [!definition] 量子梳(comb)作为特殊的量子过程矩阵(3.10)  [[lorenz2020QuantumCausalStructure\|lorenz2020QuantumCausalStructure]]
> \label{def:quantumcomb}
>   作为梳的输入和输出非平凡。设$\sigma\equiv \sigma_{A_0\ldots A_{n}}=\sigma_{PA_1\ldots A_{n-1}F}=B\left(\bigotimes_{i=n}^0 A_i^{{ \text {out}}*} \otimes  {A_i^{\text {in}}}\right)=B\left(F^\mathrm{in}\otimes \bigotimes_{i=n-1}^1 A_i^{{ \text {out}}*} \otimes  {A_i^{\text {in}}} \otimes P^\mathrm{out*} \right)$是正定矩阵，它有 $n+1$个节点$S=(A_0,A_1,\ldots,A_n)=(P,A_1,\ldots,A_{n-1},F)$，但由于已经假设系统$A_n^\mathrm{out}= F^\mathrm{out}$和$A_0^\mathrm{in}=P^\mathrm{in}$是平凡的，这对应着消耗$n$份计量资源。根据记号选取的不同，有下面几组等价的定义
>
> - 如果$\sigma$还满足，
>
$$
\operatorname{tr}(\sigma)=\prod_{i=0}^n d_{A_i^{\mathrm{out}}}
$$
>
$$
{}_{A_n^\mathrm{i}A_{n-1}^\mathrm{o}} \sigma ={}_{A_n^\mathrm{i}}\sigma
$$
>
$$
{}_{A_n^\mathrm{i}A_{n-1}\cdots A_l A_{l-1}^\mathrm{o}}\sigma={}_{A_n^\mathrm{i} A_{n-1}\cdots A_l}\sigma,~l=1,\cdots ,n-1
$$
>   则称$\sigma$为**$n$-量子梳** 。
> - 代入$A_0^\mathrm{out}= P^\mathrm{out}$和$A_n^\mathrm{in}=F^\mathrm{in}$，可得要满足的条件为
>
$$
\begin{gathered}
\operatorname{tr}\left(\sigma_{A_0 \ldots A_n}\right)=d_{P^{\text {out}}} d_{A_1^{\text {out}}} \cdots d_{A_{n-1}^{\text {out}}} \\
{}_{F^{\mathrm{i}} A_{n-1}^{\mathrm{o}}}\sigma={ }_{F^{\mathrm{i}}} \sigma \\
{}_{ F^{\mathrm{i}} A_{n-1} \cdots A_l A_{l-1}^{\mathrm{o}}} \sigma={ }_{F^{\mathrm{i}} A_{n-1} \cdots A_l} \sigma, l=2, \cdots, n-1 \\
{}_{  F^{\mathrm{i}} A_{n-1} \cdots A_1 P^{\mathrm{o}}} \sigma={ }_{F^{\mathrm{i}} A_{n-1} \cdots A_1} \sigma,(\text { 对应上式取 } l=1)
\end{gathered}
$$
>
>   eq-eq-defofcomb_1
> - 同样地 代入$A_0^\mathrm{out}= P^\mathrm{out}$和$A_n^\mathrm{in}=F^\mathrm{in}$，
>
$$
\begin{gathered}
\operatorname{tr}\left(\sigma\right)=d_{P^{\text {out}}} d_{A_1^{\text {out}}} \cdots d_{A_{n-1}^{\text {out}}} \\
\mathrm{tr}_F\sigma =\sigma_{(n - 1)}\otimes \mathbb{I}_{A_{n- 1}^\mathrm{o}}\\
\mathrm{tr}_{A^\mathrm{i}_{l}}\sigma_{(l )} =\sigma_{(l - 1)}\otimes \mathbb{I}_{A_{l - 1 }^\mathrm{o}} ,~ l= 2,\ldots, n-1 \\
\mathrm{tr}_{A^\mathrm{i}_{1}}\sigma_{(1)} = \mathbb{I}_{P^\mathrm{o}}
\end{gathered}
$$
>
>   eq-eq-defofcomb_2
>
>   其中$\sigma_{(l )}\in B(P^ \mathrm{o}   A_{1,\ldots ,l-1} A_{l}^\mathrm{i})$。
> - 以梳齿为中心来标记$\mathrm{in}$和$\mathrm{out}$，对定义中的式\eqref{eq:defofcomb_1}做替换
> - $P^\mathrm{o}\rightarrow T_1^\mathrm{in} ,A_l^\mathrm{i}\rightarrow T_{l}^\mathrm{o},A_l^\mathrm{o}\rightarrow T_{l+1}^i,F^\mathrm{i}\rightarrow T_n^\mathrm{o}$，定义成为$\sigma \in B\left(\bigotimes_{i=1}^n T_i^\mathrm{in*}\otimes T_i^\mathrm{out}\right)$
>
$$
\begin{gathered}
\operatorname{tr}(\sigma)=\prod_{i=1}^n d_{T_i^{\mathrm{in}}} \\
{}_{ T_n \ldots T_{l}} \sigma = {}_{T_n \ldots T_{l+1} T_{l}^{\mathrm{o}}} \sigma, l=1 ,\ldots, n
\end{gathered}
$$
>
>   eq-eq-defofcomb-3
>
>   由于记号的变动，原来非常麻烦的三个等式变成了一个等式。
>
>
>
>
>
>
>
>
>
>
>
>
>   取特殊情况：作为梳的输入和输出是平凡的，进一步假设$F^\mathrm{in}=A_n^\mathrm{i}$和$P^\mathrm{out}=A_0^\mathrm{o}$是平凡的。上面的定义成为$\sigma\equiv \sigma_{A_1\ldots A_{n-1}}=B\left(\bigotimes_{i=n-1}^1 A_i^{{ \text {out}}*} \otimes  {A_i^{\text {in}}}\right)$，满足
>
$$
\mathrm{tr}(\sigma_{A_1 \ldots A_{n-1}})=d_{A_1^\mathrm{out}}\cdots d_{A_{n-1}^\mathrm{out}}
$$
>
$$
{}_{A_{n-1}^\mathrm{o}} \sigma =\sigma
$$
>
$$
{}_{A_{n-1}\cdots A_l A_{l-1}^\mathrm{o}}\sigma={}_{ A_{n-1}\cdots A_l}\sigma,~l=1,\cdots ,n-2
$$
>   其中$l=n-1$对应的约束是平凡的，已经略去。这定义了一个$n-1$个节点的$n$-量子梳。


> [!note]
> - 由于量子梳总是可以用一般的量子线路来实现（待证），在这个意义上量子梳并非量子理论真正的高阶推广。
>
>
>
>   与其他文献中的定义的一致性
>
> - 第一种定义与精密测量的文章{（[[liuFullyOptimizedQuantumMetrology\|liuFullyOptimizedQuantumMetrology]] (7)）}中的定义相同。
> - 第一种定义修改空间的记号之后与定理\ref{th:projeccarofcomb}相同。
> - 第二种定义，如果退化到$n=2$，则和不能发送信息的定义\ref{def:nosignalling}相同。
> - 第二种定义与{（[[lorenz2020QuantumCausalStructure\|lorenz2020QuantumCausalStructure]] (3.10)）}中的定义相同。量子梳都具有确定的因果关系，并由节点的顺序确定，$A_i$不能向$A_j$通信如果，$i>j$。
>
>
>   \myemph{问题}：量子梳是否规定了过程的因果结构？
>
>   \myemph{问题}：量子梳是是幺正过程？量子梳不一定是幺正的，但由于其具有确定的因果顺序，所以根据定理{（[[lorenz2020QuantumCausalStructure\|lorenz2020QuantumCausalStructure]] Th.5.1）}，它是可幺正拓展的。
>
>   容易证明量子梳都是归一化的过程矩阵。

    
> [!abstract] Contents
> - 在例\ref{ex:quantumprocess2}的第一点中，根据信道的先后作用顺序，存在确定的因果顺序，即$S=(A_2,A_1)$，$A_2$先于$A_1$，$\sigma_{A_1A_2}$是一个量子梳，因为$\sigma_{A_1A_2}=\mathbb{I}_{A_1^{\mathrm{out}*}}\otimes \rho^\mathcal{C}_{A_2^\mathrm{out}|A_1^\mathrm{in}}\otimes \rho_{A_2^\mathrm{in}}$在$A_1^{\mathrm{out}*}$上是平凡的，且$\mathrm{tr}_{A_1}\sigma_S=    \mathrm{tr}_{A_1^{\mathrm{in}}}\left( \rho^\mathcal{C}_{A_2^\mathrm{out}|A_1^\mathrm{in}} \right)\otimes \rho_{{A_2}^\mathrm{in}}=\mathbb{I}_{A_2^{\mathrm{out}*}} \otimes \rho_{A_2^\mathrm{in}}$在$A_2^{\mathrm{out}*}$上是平凡的。
> - 在例\ref{ex:quantumprocess2}的第二点中，根据信道的先后作用顺序，存在确定的因果顺序，即$S=(A_1,A_2)$，$A_1$先于$A_2$，$\sigma_{A_1A_2}$是一个量子梳，因为$\sigma_{A_1A_2}=\rho_{A_1^\mathrm{in}}\otimes  \rho^\mathcal{C}_{A_1^\mathrm{out}|A_2^\mathrm{in}}\otimes\mathbb{I}_{A_2^{\mathrm{out}*}}$在$A_2^{\mathrm{out}*}$上是平凡的，且$\mathrm{tr}_{A_2}\sigma_S=\rho_{A_1^\mathrm{in}}\otimes \mathrm{tr}_{A_2^{\mathrm{in}}}\left( \rho^\mathcal{C}_{A_1^\mathrm{out}|A_2^\mathrm{in}} \right) =\rho_{A_1^\mathrm{in}} \otimes\mathbb{I}_{A_1^{\mathrm{out}*}}$在$A_1^{\mathrm{out}*}$上是平凡的。

上面的例子需要重新检验。
    
一个$2$-梳吃进去一个信道，返回一个信道，在这里梳可以理解为一个在前后插入信道的操作$\mathcal{C}\mapsto \mathcal{E}^{A_1}\circ \mathcal{C}\circ \mathcal{E}^{A_2}$，在量子线路图上表现为有两个梳齿。
    
> [!theorem] 量子梳的投影刻画{} （[[hoffreumon2021MultiroundProcessMatrix\|hoffreumon2021MultiroundProcessMatrix]] Apd.1）
{ #th-th-projeccarofcomb}

> - \begin{center}
>   \includegraphics[width=0.7\textwidth]{image//2025-02-15-12-03-51.png}
>   \end{center}
>   一个正定矩阵$\sigma=B\left(\bigotimes_{i=1}^n T_i^{{ \text {in}}*} \otimes  {T_i^{\text {out}}}\right)$是量子梳当且仅当
>
$$
\mathrm{tr}(\sigma) = \prod_{i=1}^{n} d_{T^\mathrm{in}_i}
$$
>   以及
>
$$
\mathcal{P}_n(\sigma)= \sigma
$$
>   其中
$$
\mathcal{P}_n=\mathcal{I}-\mathcal{D}_{T^\mathrm{out}_n}(\mathcal{I}-\mathcal{D}_{T_n^\mathrm{in}}\mathcal{P}_{n-1})= \mathcal{I}-\mathcal{D}_{T^\mathrm{out}_n} +\mathcal{D}_{T_n}\mathcal{P}_{n-1},~\mathcal{P}_0=\mathcal{I}
$$
将迭代式展开得到
>
$$
\mathcal{P}_n=\mathcal{I}-\mathcal{D}_{T^\mathrm{out}_n}(\mathcal{I}-\mathcal{D}_{T_n^\mathrm{in}}(\cdots (\mathcal{I}-\mathcal{D}_{T_1^\mathrm{out}}(\mathcal{I}-\mathcal{D}_{T_1^\mathrm{in}}))\cdots))
$$

> [!proof]
> - 根据定义
>
$$
\mathrm{tr}(\sigma) = \prod_{i=1}^{n} d_{T^\mathrm{in}_i}
$$
>
$$
{}_{T_n\ldots T_{l  \bullet } }\sigma={}_{T_n\ldots T_{l+1}T_{l  \bullet } ^\mathrm{o}}\sigma ,~l=1\cdots n
$$
>   由于记号的变动，原来非常麻烦的三个等式变成了一个等式。
>
>   (必要性) 只证明$n=2$的情形，
>
$$
\mathcal{P}_2(\sigma)=(1-\mathcal{D}_{T_2^\mathrm{o}}+\mathcal{D}_{T_2}-\mathcal{D}_{T_2 T_1^\mathrm{o}}+\mathcal{D}_{T_1T_2} )(\sigma) =\sigma
$$
>   最后一个等号是因为左侧的后面两项抵消了。
>
>   ($\ldots$)

> [!note]
> - 字母$T$的意思是齿。
>   前三个投影算符为
>
$$
\begin{aligned}
\mathcal{P}_1 & =  \mathcal{I}-\mathcal{D}_{T_1^\mathrm{o}}+\mathcal{D}_{T_1} \\
\mathcal{P}_2 & = \mathcal{I}-\mathcal{D}_{T_2^\mathrm{o}}+\mathcal{D}_{T_2}-\mathcal{D}_{T_2 T_1^\mathrm{o}}+\mathcal{D}_{T_1T_2} \\
\mathcal{P}_3 & = \mathcal{I}-D_{T_3^\mathrm{o}}-\mathcal{D}_{T_3}\mathcal{P}_2
\end{aligned}
$$
>
>
>   显然$\mathcal{P}_n$是保迹的。
>
>   注意到当$n=1$时，就退化为命题\ref{prop:choiandtracep}。
>
>   如果第一个输入是平凡的，那么有$\mathcal{P}_0=\mathcal{P}_1=\mathcal{I}$，迭代式不变，因此公式向后推迟了一颗齿\footnote{验证参见：量子梳comb的投影刻画.nb-第一个输入平凡的情形。}
>
$$
\mathcal{P}_n=\mathcal{I}-\mathcal{D}_{T^\mathrm{out}_n}(\mathcal{I}-\mathcal{D}_{T_n^\mathrm{in}}(\cdots (\mathcal{I}-\mathcal{D}_{T_2^\mathrm{out}}(\mathcal{I}-\mathcal{D}_{T_2^\mathrm{in}}))\cdots))
$$
>
>   eq-eq-mpmprojdropfirsti
>
>   如果最后一个输出是平凡的，那么公式最后会少一个空间
>
$$
\mathcal{P}_n=\mathcal{I}-\mathcal{D}_{T_n^\mathrm{in}}(\cdots (\mathcal{I}-\mathcal{D}_{T_1^\mathrm{out}}(\mathcal{I}-\mathcal{D}_{T_1^\mathrm{in}}))\cdots)
$$
>
>   当$n=3$且第一个输入与最后一个输出平凡时，
>
$$
\mathcal{P}_3 =\mathcal{I}-\mathcal{D}_{T_3^\mathrm{in}} (\mathcal{I}-\mathcal{D}_{T_1^\mathrm{out}}(\mathcal{I}-\mathcal{D}_{T_1^\mathrm{in}}))
$$
>   利用定理\ref{th:normaltpprocessprojchar}中的记号，得到$\mathcal{P}_3= \mathcal{D}_{B^\mathrm{o}}-\mathcal{D}_{B}+\mathcal{D}_{A^\mathrm{o}B}$，与一般的量子过程矩阵的约束式\eqref{eq:2pointprocess}进行比较，量子梳是比过程矩阵更强的约束，下面的等式证明了这一点\footnote{证明非常机械，参见：量子梳comb的投影刻画.nb。}
>
$$
\mathcal{P}_3  \circ L_V = \mathcal{P}_3
$$
>
>   $\mathcal{P}_n$保迹、保厄米、在内积空间$B(B(\mathsf{H}))$上是厄米的。

    
> [!theorem] 量子梳的Kraus算符刻画 （[[dong2021ControlledQuantumOperations\|dong2021ControlledQuantumOperations]] Apd.D）
{ #th-th-krausofcomb}

> 

   
> [!theorem] 不同顺序的叠加的量子梳
> 

### 无限层级的高阶量子映射
- 引用的公式均来自 [[Dynamics of Quantum Causal Structures\|Dynamics of Quantum Causal Structures]] 

这个问题的核心在于，一个“有效”的变换（或称“超映射”）必须将**任何**一个有效的输入过程矩阵，都映射成一个有效的输出过程矩阵。这要求该变换必须保持过程矩阵的所有定义性属性。下面我们分两种形式来表述这些条件，并解释其如何推广到高阶。

#### 1. 基础变换：从过程矩阵到过程矩阵的映射 (二阶超映射)

一个标准的**过程矩阵 $W$** 本身可以被看作是一个**一阶超映射**（它将局域操作映射到概率、或者将信道映射到信道）。因此，一个**将过程矩阵映射到过程矩阵的变换 $\mathcal{A}$** 就是一个**二阶超映射**。

##### A. 线性映射形式 ($\mathcal{A}$)

一个线性映射 $\mathcal{A}: \mathcal{L}(\mathcal{H}_1) \to \mathcal{L}(\mathcal{H}_2)$ 是一个有效的过程矩阵变换，当且仅当它满足以下三个条件：

1.  **完备正性 (Completely Positive, CP)**:
    $\mathcal{A}$ 必须是一个完备正映射。这保证了对于任何有效的输入过程矩阵 $W_1$（即使它与一个外部系统纠缠），输出 $\mathcal{A}(W_1)$ 都是正半定的，满足条件 (2a)。

2.  **迹重标 (Trace Rescaling)**:
    $\mathcal{A}$ 必须将输入过程矩阵的迹 $d_{O1}$（输入空间的输出维度）正确地重标为输出过程矩阵的迹 $d_{O2}$（输出空间的输出维度）。这意味着对于任何输入 $W_1$，$\text{Tr}[\mathcal{A}(W_1)] = \frac{d_{O2}}{d_{O1}} \text{Tr}[W_1]$。这保证了输出满足条件 (2b)。如果输入和输出空间同构（$d_{O1}=d_{O2}$），那么 $\mathcal{A}$ 就是一个保迹映射 (Trace-Preserving, TP)。

3.  **子空间保持 (Subspace Preservation)**:
    这是最关键且独特的条件。它确保了输出矩阵 $\mathcal{A}(W_1)$ 仍然位于有效的过程矩阵子空间内，满足条件 (2c)。该条件用投影超算符 $\mathcal{P}_1$ 和 $\mathcal{P}_2$ 表示为：
    $$
    \mathcal{P}_2 \circ \mathcal{A} \circ \mathcal{P}_1 = \mathcal{A} \circ \mathcal{P}_1
    $$
    这个等式意味着：对一个**已经满足**输入子空间条件的对象（即 $\mathcal{P}_1$ 作用于其上不变）进行变换 $\mathcal{A}$，其结果**自动满足**输出子空间条件（即 $\mathcal{P}_2$ 作用于其上不变）。

##### B. 蔡氏矩阵形式 ($C_\mathcal{A}$)

利用 Choi-Jamiołkowski (CJ) 同构，上述三个条件可以等价地表示为对变换 $\mathcal{A}$ 的 CJ 矩阵 $C_\mathcal{A} \in \mathcal{L}(\mathcal{H}_1 \otimes \mathcal{H}_2)$ 的约束：

1.  **正半定性**:
    $\mathcal{A}$ 是完备正的，当且仅当其 CJ 矩阵是正半定的。
    $$
    C_\mathcal{A} \ge 0
    $$

2.  **部分迹条件**:
    $\mathcal{A}$ 是迹重标的，当且仅当 $C_\mathcal{A}$ 对输出空间 $\mathcal{H}_2$ 取部分迹后满足：
    $$
    \text{Tr}_2(C_\mathcal{A}) = \frac{d_{O2}}{d_{O1}} \mathbb{1}_1
    $$
    其中 $\mathbb{1}_1$ 是输入空间 $\mathcal{H}_1$ 上的单位算子。

3.  **投影条件**:
    子空间保持条件被转化为一个作用在 CJ 矩阵 $C_\mathcal{A}$ 上的代数方程。注意这里的 $P_1, P_2$ 是作用在算子空间上的算子，而不是超算符 $\mathcal{P}$。
    $$
    P_1 \otimes \mathbb{1}(C_\mathcal{A}) = P_1 \otimes P_2(C_\mathcal{A})
    $$
    这个条件确保了由 $C_\mathcal{A}$ 定义的映射能够正确地将一个有效的输入过程矩阵映射到另一个有效的输出过程矩阵。

---

#### 2. 推广到高阶变换

文中通过一个巧妙的技巧，将上述条件统一并推广到了任意高阶。核心思想是**将子空间保持条件本身也写成一个投影算子的形式**。

-   一个**一阶超映射** (即过程矩阵 $W$) 的 CJ 矩阵就是它自己 $W^{(1)}=W$。它满足的条件是 $\mathcal{P}^{(1)}(W^{(1)}) = W^{(1)}$，其中 $\mathcal{P}^{(1)}$ 就是最开始定义的投影算符 $\mathcal{P}$。

-   一个**二阶超映射** (即变换 $\mathcal{A}$) 的 CJ 矩阵 $W^{(2)}=C_\mathcal{A}$ 满足的条件可以写成 $\mathcal{P}^{(2)}(W^{(2)}) = W^{(2)}$，其中投影算符被定义为：
    $$
    \mathcal{P}^{(2)} := \mathbb{1} \otimes \mathbb{1} - P_1 \otimes \mathbb{1} + P_1 \otimes P_2
    $$

-   这个结构可以递归地建立一个**高阶变换的层级**。一个 **n 阶超映射** $\mathcal{A}^{(n)}$ 是一个将 (n-1) 阶有效超映射映射到 (n-1) 阶有效超映射的变换。其 CJ 矩阵 $W^{(n)}$ 必须满足：（需要补充参考文献）

    1.  **正半定性**: $W^{(n)} \ge 0$
    2.  **部分迹条件**: 满足相应的迹重标条件。
    3.  **投影条件**: $\mathcal{P}^{(n)}(W^{(n)}) = W^{(n)}$
        其中 $n$ 阶投影算符由 $(n-1)$ 阶投影算符递归定义：
        $$
        \mathcal{P}^{(n)} = \mathbb{1} \otimes \mathbb{1} - \mathcal{P}^{(n-1)}_1 \otimes \mathbb{1} + \mathcal{P}^{(n-1)}_1 \otimes \mathcal{P}^{(n-1)}_2
        $$

**总结**：无论是标准变换还是高阶变换，其核心条件都可以统一为**正性**、**迹条件**和**投影不变性**这三条。高阶框架的精髓在于，定义有效变换的投影算符本身可以从低阶的投影算符递归地构造出来，从而形成了一个具有一致结构的无限层级。

## 量子因果结构

> [!definition] 幺正过程
> - 当量子过程矩阵对应的信道是幺正信道时，称量子过程为**幺正过程**。

> [!note]
> - 幺正信道的一个容易检验的充分性条件：秩为1，且构成信道，将输出trace掉之后构成输入空间上的单位阵。

> [!definition] 不能发送信息
> - \label{def:nosignalling}
>   使用蔡氏矩阵的第二种约定，对于两节点过程$\sigma_{AB}$，下列等价{（[[barrett2021CyclicQuantumCausal\|barrett2021CyclicQuantumCausal]] p.3）}
>
> - 对于任何$\tau_A$，概率分布$P(k_A)=\operatorname{tr}\left[\sigma_{A B}\left(\tau_A^{k_A} \otimes \tau_B\right)\right]$与$B$节点处的干扰无关，即与$\tau_B$的选择无关。
> - $\sigma_{A B}=\sigma_{A B^{\text {in}}} \otimes \mathbb{I}_{B^{\text{out*}}}$
>   此时称**$B$不能向$A$送信**，记作$B\npreceq A$。

有的作者定义关于全正映射CPM的发信结构的时候采用一些看上去更简单的定义，改变输入的信道观察是否能够得到同一个信道，从而判断某个口能否向另一个口输出信息，[[Embedding cyclic information-theoretic structures in acyclic spacetimes no-go results for indefinite causality\| embed ICO]] def 10。

> [!proof]
> - $(\impliedby)$利用$\mathrm{tr}_{B^\mathrm{out*}}\tau_B=\mathbb{I}_{B^\mathrm{in}}$可得。
>
>   $(\implies)$根据两节点过程矩阵的刻画{（[[oreshkov2012QuantumCorrelationsNo\|oreshkov2012QuantumCorrelationsNo]] Sup.）}，
>
$$
\begin{aligned}
W^{A_1 A_2 B_1 B_2} & =\frac{1}{d_{A_1} d_{B_1}}\left(\mathbb{I}+\sigma^{B \preceq  A}+\sigma^{A \preceq  B}+\sigma^{A \npreceq \nsucceq    B}\right), \\
\sigma^{B \preceq A} & \equiv \sum_{i j>0} c_{i j} \sigma_i^{A_1} \sigma_j^{B_2}+\sum_{i j k>0} d_{i j k} \sigma_i^{A_1} \sigma_j^{B_1} \sigma_k^{B_2}, \\
\sigma^{A \preceq B} & \equiv \sum_{i j>0} e_{i j} \sigma_i^{A_2} \sigma_j^{B_1}+\sum_{i j k>0} f_{i j k} \sigma_i^{A_1} \sigma_j^{A_2} \sigma_k^{B_1}, \\
\sigma^{A \npreceq \nsucceq   B} & \equiv \sum_{i>0} v_i \sigma_i^{A_1}+\sum_{i>0} x_i \sigma_i^{B_1}+\sum_{i j>0} g_{i j} \sigma_i^{A_1} \sigma_j^{B_1}, \\
\text { where } c_{i j}, & d_{i j k}, e_{i j}, f_{i j k}, g_{i j}, v_i, x_i \in \mathbb{R} .
\end{aligned}
$$
>
>   eq-eq-chaoftwopointporcess
>
>   上式中的1和2分别对应$\mathrm{in}$和$\mathrm{out}$，$P(k_A)$与$\tau_B$无关意味着$\sigma^{B \preceq A}=0$。

> [!note]
> - $A$先于$B$发生时，$B$不能向$A$送信。反之，即便$A$先于$B$发生($A$是$B$的原因)也不意味着$A$能够影响$B$，一个事件对未来的影响可能完全被随机性掩盖掉{（[[barrett2021CyclicQuantumCausal\|barrett2021CyclicQuantumCausal]] (2)）}，这在经典情形中也可以被理解，函数的值完全可能和输入的值无关，例如经典比特$A$和$C$的奇偶性决定$B$，如果$C$是均匀的零一分布，但的取值是未知的，那么$B$的分布也是均匀的零一分布，与$A$的值无关，量子情形的例子参见命题\ref{prop:nosignalingtofuture}。
>
>   如果将两节点过程的$A_1B_2$trace掉，或者将$A_2B_1$trace掉，观察哪些项会留下就能发现两体过程会退化为剩下的两个节点之间的合法信道，即单体的过程，不定因果性将消失。

> [!definition] 幺正信道和幺正过程的因果结构{\cite[Def.3,4
> - {barrett2021CyclicQuantumCausal}}]\label{def:causalstrucunitary}
>   给定幺正信道 $\rho_{C D \mid A B}^{\mathcal{U}}$,记 $A \nrightarrow D$**$(A$ 不能影响 $D)$**，当且仅当，存在边缘信道 $\mathcal{M}$，使得
$$
\operatorname{tr}_C\left[\rho_{C D \mid A B}^{\mathcal{U}}\right]=\rho_{D \mid B}^{\mathcal{M}} \otimes \mathbb{I}_{A^*}
$$
>   或等价地
>
$$
\mathrm{tr}_C \circ \mathcal{U}=  \mathcal{M}\circ  \mathrm{tr}_A
$$
>   如果$A$ 能够影响$D$，即对于任何信道$\mathcal{M}$，都有
>
>
$$
\operatorname{tr}_C\left[\rho_{C D \mid A B}^{\mathcal{U}}\right]\neq \rho_{D \mid B}^{\mathcal{M}} \otimes \mathbb{I}_{A^*}
$$
>   或等价地
>
$$
\mathrm{tr}_C \circ \mathcal{U}\neq   \mathcal{M}\circ  \mathrm{tr}_A
$$
>   称则$A$ 是$D$的**直接原因**(direct cause)，对于给定的幺正信道 $\rho_{C_1 \ldots C_l \mid B_1 \ldots B_k}^{\mathcal{U}}$ 有 $k$ 个输入和$l$ 个输出子系统，其**因果结构**是节点的因果关系的几何，用一个以$\{C_l\}$和$\{B_k\}$为节点的有向无圈图(DAG)表示，当$B_i$是$C_j$的直接原因时，存在箭头$B_i\rightarrow C_j$。
>
>   基于幺正信道的子系统之间的因果关系，可以定义幺正过程的节点之间的因果关系。
>
>   给定幺正过程 $\sigma_{A_1 \ldots A_n}=\rho_{A_1 \ldots A_1 \mid A_n \ldots A_n}^{\mathcal{U}}$，记 $A_j \nrightarrow A_i$ (节点 $A_j$ 不影响节点 $A_i$ )，当且仅当在幺正信道$\mathcal{U}$中， $A_j^{\text {out}}$ 不影响 $A_i^{\text {in}}$  。如果 $A_j$ 能够影响 $A_i$，那么 $A_j$ 是 $A_i$的直接原因。 幺正过程的**因果结构**是是节点之间的因果关系的几何，用以$\{A_i\}$为节点的DAG表示，当$A_j$是$A_i$的节点时，存在箭头$A_j \rightarrow A_i$ 。

> [!proof]
> - $A$不能影响$D$的定义的等价性的证明。（待证）

> [!note]
> - 对于两节点的幺正过程，设过程矩阵为$\sigma_{AB}=\rho^\mathcal{U}_{AB|AB}$，则$B\nrightarrow A$等价于
>   $B^\mathrm{out*}\nrightarrow  A^\mathrm{in}$等价于$\mathrm{tr}_{B^\mathrm{in*}}\left(\sigma_{AB}\right)=\rho^\mathcal{M}_{A^\mathrm{in}|A^\mathrm{out}}\otimes \mathbb{I}_{B^\mathrm{out*}}$。而$B\npreceq A$定义为$\sigma_{AB}=\sigma_{AB^{\mathrm{in}}}\otimes \mathbb{I}_{B^\mathrm{out*}}$。两个定义是等价的，先证$\implies$，根据式\eqref{eq:chaoftwopointporcess}可知，$\sigma^{B\preceq A}=0$，根据定义\ref{def:nosignalling}，这就是$B \npreceq A$；再证$\impliedby$，只要求迹再证明系统$\mathrm{tr}_{B^\mathrm{in}}(\sigma_{AB^\mathrm{in}})$是合法信道即可，正定性显然，只要检验保迹性，实际上利用式\eqref{eq:chaoftwopointporcess}，有$\mathrm{tr}_{A^{\mathrm{in}}B^\mathrm{in}}(\sigma_{AB^\mathrm{in}})=\mathrm{tr}_{A^\mathrm{out*}B}(\sigma_{AB})/d_{B^\mathrm{out*}}=\mathbb{I}_{A^\mathrm{out*}}$

> [!definition] 推广的量子因果模型 Quantum causal model-generalized Def.1;(4) barrett2021CyclicQuantumCausal
>   使用蔡氏矩阵的第二种约定。 A QCM is given by:
>
>   (1) a causal structure represented by a directed graph $G$ with vertices corresponding to quantum nodes $A_1, \ldots, A_n$,
>
>   (2) for each $A_i$, a quantum channel $\rho_{A_i \mid P a\left(A_i\right)} \in B\left(\mathsf{H}_{A_i^{\text {in}}} \otimes \mathsf{H}_{P a\left(A_i\right)^{\text {out}}}^*\right)$, where $\operatorname{Pa}\left(A_i\right)$ denotes the set of parents of $A_i$ according to $G$, such that $\left[\rho_{A_i \mid P a\left(A_i\right)}, \rho_{A_j \mid P a\left(A_j\right)}\right]=0$ for all $i, j$ and such that $\sigma_{A_1 \ldots A_n}=$ $\prod_i \rho_{A_i \mid P a\left(A_i\right)}$ is a process operator over the quantum nodes $A_1, \ldots, A_n$.
>
>   称量子因果模型是**忠实的**(faithful)，如果对于任何信道$\rho_{A_i|Pa(A_j)}$，每个$A_j\in Pa(A_i)$都能对$A_i$发信，即
>
$$
\rho_{A_i \mid P a\left(A_i\right)} \neq \frac{1}{d_j} \operatorname{tr}_{A_j^{\text{out*}}}\left(\rho_{A_i \mid P a\left(A_i\right)}\right) \otimes \mathbb{I}_{A_j^{\text{out*}}},~\forall ~j
$$
>
>   等价地简记为
>
$$
\rho_{A_i \mid P a\left(A_i\right)} \neq {}_{A_j^{\text{out*}}}\left(\rho_{A_i \mid P a\left(A_i\right)}\right) ,~\forall ~j
$$

> [!note]
> - 推广是指从无圈图推广到圈图。
>
>   简单的量子因果模型例如\eqref{eq:simplestcausalmodel}。

 

> [!theorem] 因果结构意味着过程矩阵的分解{} （[[barrett2021CyclicQuantumCausal\|barrett2021CyclicQuantumCausal]] Th.1）
{ #th-th-decompoofcs}

> - 给定幺正信道以及因果结构，存在分解
>
$$
\rho_{C_1 \ldots C_l \mid B_1 \ldots B_k}^{\mathcal{U}}=\prod_{i=1}^l \rho_{C_i \mid P a\left(C_i\right)}
$$
>   其中任何两个因子都是对易的。

> [!theorem] 信道的蔡氏矩阵与其幺正变换的关系
{ #th-th-underlydinguniofchoi}

> - 使用蔡氏矩阵的第一种约定，设$U:B(A\otimes C\otimes D)\rightarrow B(B\otimes E\otimes F)$是信道$\mathcal{E}=\mathrm{tr}_F\circ \mathcal{U}\circ \left((\cdot)\otimes\rho_D\right)$的幺正变换，则
>
$$
\rho_{BE|AC}^\mathcal{E}=\mathrm{tr}_{D^*F}\left(\rho^\mathcal{U}_{BEF|ACD}(\rho_D)^\top\right)=\mathrm{tr}\left(\rho^\mathcal{U}_{BEF|ACD}\tau_D^\mathrm{id}\rho_D\right)=\overline{\mathrm{tr}}_D \mathrm{tr}_F\left(\rho^\mathcal{U}_{BEF|ACD}\rho_D\right)
$$
>   其中$\overline{\mathrm{tr}}_D(\cdot)=\mathrm{tr}_{D^*D}(\tau_D^\mathrm{id}(\cdot))$，$\tau_A^{\mathrm{id}}\equiv \left(\rho _{D|D}^{\mathrm{id}}\right)^\top=\rho _{D^*|D^*}^{\mathrm{id}}=\sum_{i, j}|i\rangle_{D^*}\langle j| \otimes|i\rangle_D\langle j|$

> [!proof]
> - 在计算复合信道的蔡氏矩阵时，即便输入和输出空间有重叠，也要设为不同的空间，因此设
>
$$
B\left(A_1 \otimes C_1\right) \xrightarrow{( \cdot) \otimes \rho_D} B\left(A_2 \otimes C_2 \otimes D\right) \xrightarrow{\mathcal{U}} B\left(B_1 \otimes E_1 \otimes F\right) \xrightarrow{\mathrm{tr}_F} B\left(B_2 \otimes E_2\right)
$$
>   根据链积的性质，又或者利用命题\ref{prop:compochannalchoi}，有
>
$$
\begin{aligned}
& \rho_{B_{2}E_{2}|A_{1}C_{1}}^{\mathcal{E}} = \rho_{B_{1}E_{1}F|B_{2}E_{2}}^{\mathrm{tr}_{F}}\star \rho_{B_{1}E_{1}F|A_{2}C_{2}D}^{\mathcal{U}}\star \rho_{A_{2}C_{2}D|A_{1}C_{1}}^{(\cdot)\otimes\rho_{D}}  \\ & =\mathrm{{tr}}_{A_{2}^{*}C_{2}^{*}D^{*}B_{1}^{*}E_{1}^{*}F^{*}}\left(\left(\rho_{A_{2}C_{2}D|A_{1}C_{1}}^{(\cdot)\otimes\rho_{D}}\right)^{\top_{A_{2}C_{2}D}}\left(\rho_{B_{1}E_{1}F|A_{2}C_{2}D}^{U}\right)^{\top_{B_{1}E_{1}F}}\rho_{B_{1}E_{1}F|B_{2}E_{2}}^{\mathrm{tr}_{F}}\right)_{B_2E_2~B_1^*E_1^*F^*~A_2^*C_2^*D^*~A_1^*C_1^*}\\
& =\mathrm{{tr}}_{A_{2}^{*}C_{2}^{*}D^{*}B_{1}^{*}E_{1}^{*}F^{*}}\left(\left(|j\rangle_{A_{2}^{*}C_{2}^{*}}\langle i|\otimes\left(\rho_{D}\right)^{\top}\otimes|i\rangle_{A_{1}^{*}C_{1}^{*}}\langle j|\right)\left(\rho_{B_{1}E_{1}F|A_{2}C_{2}D}^{U}\right)^{\top_{B_{1}E_{1}F}}\left(|k\rangle_{B_{2}E_{2}}\langle l|\otimes|k\rangle_{B_{1}^{*}E_{1}^{*}}\langle l|\otimes\mathbb{{I}}_{F^{*}}\right)\right)\\
& =\mathrm{{tr}}_{A_{2}^{*}C_{2}^{*}D^{*}B_{1}^{*}E_{1}^{*}F^{*}}\left(\left(|j\rangle_{A_{2}^{*}C_{2}^{*}}\langle i|\otimes\left(\rho_{D}^{\top}\right)\otimes|i\rangle_{A_{1}^{*}C_{1}^{*}}\langle j|\right)\left(U|p\rangle_{A_{2}C_{2}}\langle m|\otimes|q\rangle_{D}\langle n|U^{\dagger}\right)^{\top}\otimes|q\rangle_{D^{*}}\langle n|\left(|k\rangle_{B_{2}E_{2}}\langle l|\otimes|k\rangle_{A_{1}^{*}C_{1}^{*}}\langle l|\otimes\mathbb{{I}}_{F^{*}}\right)\right)\\
& =\mathrm{{tr}}_{D^{*}B_{1}^{*}E_{1}^{*}F^{*}}\left(\left(\left(\rho_{D}\right)^{\top}\otimes|i\rangle_{A_{1}^{*}C_{1}^{*}}\langle j|\right)\left(U|p\rangle_{A_{2}C_{2}}\langle m|\otimes|q\rangle_{D}\langle n|U^{\dagger}\right)^{\top}\otimes|q\rangle_{D^{*}}\langle n|\left(|k\rangle_{B_{2}E_{2}}\langle l|\otimes|k\rangle_{A_{1}^{*}C_{1}^{*}}\langle l|\otimes\mathbb{{I}}_{F^{*}}\right)\right)\\
& =\mathrm{{tr}}_{D^{*}B_{1}^{*}E_{1}^{*}F^{*}}\left(_{B_{1}^{*}E_{1}^{*}}\langle|\left(U|p\rangle_{A_{2}C_{2}}\langle m|\otimes|q\rangle_{D}\langle n|U^{\dagger}\right)^{\top}|k\rangle_{B_{1}^{*}E_{1}^{*}}\otimes\rho_{D}^{\top}|q\rangle_{D^{*}}\langle n|\right)|k\rangle_{B_{2}E_{2}}\langle l|\otimes|k\rangle_{A_{1}^{*}C_{1}^{*}}\langle l|\\
& =\mathrm{{tr}}_{D^{*}F}\left(_{B_{1}E_{1}}\langle k|\left(U|p\rangle_{A_{2}C_{2}}\langle m|\otimes|q\rangle_{D}\langle n|U^{\dagger}\right)|l\rangle\otimes\rho_{D}^{\top}|q\rangle_{D^{*}}\langle n|\right)|k\rangle_{B_{2}E_{2}}\langle l|\otimes|k\rangle_{A_{1}^{*}C_{1}^{*}}\langle l|\\
& =\mathrm{{tr}}_{D^{*}F}\left(\rho_{B_{1}E_{1}F|A_{2}C_{2}D}^{U}\rho_{D}^{\top}\right)
\end{aligned}
$$

> [!note]
> - 由于命题中的公式的角标设计非常合理，一定有更简单的证明方法。
>
>   实际上可以将$AC$和$BE$合成一个。将$U$推广到一般的信道这个命题也成立。

> [!proposition]
> - \label{prop:nosignalingtofuture}
>   $A,A^\prime$和$B$都是单比特系统，$\mathcal{E}$是控制比特在左侧的控制非门。求图({（[[barrett2021CyclicQuantumCausal\|barrett2021CyclicQuantumCausal]] fig.1）})中节点$AB$的过程矩阵$\sigma_{AB}$。
>
![2025-01-02-22-50-38.png](/img/user/2025-01-02-22-50-38.png)

> [!proof]
> - 设输入为直积态$\rho=\rho^A\otimes \rho^{A^\prime}$。使用第二种约定，利用定理\ref{th:underlydinguniofchoi}求得从$A^\mathrm{out}$到$B^\mathrm{in}$的信道的蔡氏矩阵，再利用例\ref{ex:quantumprocess2}可得
>
$$
\begin{aligned}
\sigma_{AB}&=\rho_{A^\mathrm{in}}\otimes \rho_{B^\mathrm{in}F|A^\mathrm{out}A^\prime}^\mathrm{CNOT}\otimes \mathbb{I}_{B^{\mathrm{out}*}}\\
& =\rho_{A^\mathrm{in}}\otimes \mathrm{tr}_{A^{\prime*} F}\left(\rho^{\mathrm{CNOT}_{A^\mathrm{out}\rightarrow A^\prime}}_{B^\mathrm{in}F|A^\mathrm{out}A^{\prime}}\rho_{A^\prime}^\top \right)\otimes \mathbb{I}_{B^{\mathrm{out}*}}\\
& =\rho_{A^\mathrm{in}}\otimes \mathrm{tr}_{A^\prime F}\left(\sum |i_1i_2\rangle_{A^{\mathrm{out}*}A^{\prime*}}\langle k_1k_2|\otimes |i_1,i_1 +i_2\rangle_{FB^\mathrm{in}}\langle k_1,k_1 + k_2 |\rho_{A^\prime}^\top\right)\otimes \mathbb{I}_{B^\mathrm{in}}\otimes \mathbb{I}_{B^{\mathrm{out}*}}\\
& =\rho_{A^\mathrm{in}}\otimes \mathrm{tr}_{A^\prime}\left(\sum |k_1i_2\rangle_{A^{\mathrm{out}*}A^{\prime*}}\langle k_1k_2|\otimes|k_1 +i_2\rangle\langle k_1 + k_2| \rho_{A^\prime}^\top\right)\otimes \mathbb{I}_{B^\mathrm{in}}\otimes \mathbb{I}_{B^{\mathrm{out}*}}
\end{aligned}
$$
> [!note]
> - 根据结果可以做出以下分析。显然$B$不能向$A$发信。当$\rho_{A^\prime}$是最大混态的时候，$\sigma_{AB}=\rho_\mathrm{in}\otimes \mathbb{I}_{A^{\mathrm{out}*}B^\mathrm{in}B^{\mathrm{out}*}}$中出现因子$\mathbb{I}_{A^{\mathrm{out}*}}$，$A$不能影响$B$($A$不能向$B$发信)，这是显然的，因为无论$A^\mathrm{out}$输出什么比特，控制非门在输入最大混态的情况下都会输出最大混态，信息被随机性掩盖了。当$\rho_{A^\prime}=|0\rangle\langle 0|$时$A$可以向$B$发信。

## 过程矩阵的因果(不)可分性
参考[[ognyanoreshkov2016CausalCausallySeparable\|ognyanoreshkov2016CausalCausallySeparable]],[[wechs2019DefinitionCharacterisationMultipartite\|wechs2019DefinitionCharacterisationMultipartite]],[[araujo2015WitnessingCausalNonseparability\|araujo2015WitnessingCausalNonseparability]]。
## 不定因果模型

不定因果可以被等价地描述为因果结构中存在圈图。
## 量子开关
参见[[量子开关\|量子开关]]
## Lugano(AF-BW)过程
Lugano过程矩阵（[[barrett2021CyclicQuantumCausal\|barrett2021CyclicQuantumCausal]] (8)）
$$
\begin{aligned}
    &\sigma_{A B C}^{\mathrm{AF}}=\rho_{A \mid B C} \rho_{B \mid C A} \rho_{C \mid A B}\\
    &\rho_{A \mid B C}=\sum_{b, c=0,1}|\neg b \wedge c\rangle\left\langle\left.\neg b \wedge c\right|_{A^{\text {in }}} \otimes \mid b, c\right\rangle\left\langle b,\left.c\right|_{\left(B^{\text {out }} C^{\text {out }}\right)^*},\right.\\
        & \rho_{B \mid C A}=\sum_{c, a=0,1}|\neg c \wedge a\rangle\left\langle\left.\neg c \wedge a\right|_{B^{\mathrm{in}}} \otimes \mid c, a\right\rangle\left\langle c,\left.a\right|_{\left(C^{\mathrm{out}} A^{\mathrm{out}}\right)^*},\right. \\
        & \rho_{C \mid A B}=\sum_{a,b=0,1}|\neg a \wedge b\rangle\left\langle\left.\neg a \wedge b\right|_{C^{\text {in }}} \otimes \mid a, b\right\rangle\left\langle a,\left.b\right|_{\left(A^{\mathrm{out}} B^{\mathrm{out}}\right)^*} .\right.
    \end{aligned}
$$
可幺正拓展
$$
\sigma_{A B C F P}^{\mathrm{BW}}=\rho_{A B C F \mid A B C P}^U,
$$
$$
\begin{aligned}
& U:|a, b, c\rangle_{A^{\text {out }} B^{\text {out }} C^{\text {out }}} \otimes|l, m, n\rangle_{\lambda_A \lambda_B \lambda_C} \\
& \mapsto|l \oplus(\neg b \wedge c), m \oplus(\neg c \wedge a), n \oplus(\neg a \wedge b)\rangle_{A^{\text {in }} B^{\text {in }} C^{\text {in }}} \\
& \quad \otimes|a, b, c\rangle_{F^{\text {in }}} .
\end{aligned}
$$
trace掉$F$并在初态输入$|000\rangle_{\lambda_{ABC}}$可以得到原来的AF过程。考虑其他的初态是否也会得到不一样的违反因果不等式的过程？
[[N体Lugano过程\|N体Lugano过程]] 
初态为$|000\rangle_{\lambda}$ 时

|  a  |  b  |  c  | $A^{\text{in}}$ | $B^{\text{in}}$ | $C^{\text{in}}$ | $F^{\text{in}}$ |
| :-: | :-: | :-: | :-------------: | :-------------: | :-------------: | :-------------: |
|  0  |  0  |  0  |        0        |        0        |        0        |       000       |
|  0  |  0  |  1  |        1        |        0        |        0        |       001       |
|  0  |  1  |  0  |        0        |        0        |        1        |       010       |
|  0  |  1  |  1  |        0        |        0        |        1        |       011       |
|  1  |  0  |  0  |        0        |        1        |        0        |       100       |
|  1  |  0  |  1  |        1        |        0        |        0        |       101       |
|  1  |  1  |  0  |        0        |        1        |        0        |       110       |
|  1  |  1  |  1  |        0        |        0        |        0        |       111       |
关于Lugano过程相关的计算参见：Lugano过程.nb
## 由量子系统控制因果顺序的量子线路 [[QC-QC\|QC-QC]]
参考{（[[wechs2021QuantumCircuitsClassical\|wechs2021QuantumCircuitsClassical]] Sec.V.B）,（[[salzger2024MappingIndefiniteCausal\|salzger2024MappingIndefiniteCausal]] Apdx.B）}。$N$个外部(相对量子梳而言)信道$\{\mathcal{A}_k:B(\mathsf{H}^{A_{k}^I}) \rightarrow B(\mathsf{H}^{A_{k}^O}),k=1,2,\ldots,n\}$，由一个QC-QC过程控制其作用顺序。不失一般性，设每个信道的蔡氏秩是1，将所有的输入空间视同，记为$\mathsf{H}^{\tilde{A}_{k_n}^I}$，将输出空间也视同，记为$\mathsf{H}^{\tilde{A}_{k_n}^I}$。显式地引入控制系统$C_n,~n=1,\ldots,N$，基底设为
$$
\left|\mathcal{K}_{n - 1}, k_n\right\rangle^{C_n}=\left|\left\{k_1, \ldots, k_{n - 1}\right\}, k_n\right\rangle^{C_n}
$$
空间维度为
$$
\mathrm{dim~}C_n= C_N^{n-1}C_{N-n+1}^1=\frac{N!}{(N-n)!(n-1)!}
$$
这个控制基底记录了上一次以及在这之前作用的信道，上一次作用了$\mathcal{A}_{k_n}$，而再前面作用的信道为$\mathcal{A}_{k_1},\cdots ,\mathcal{A}_{k_{n- 1}}$，它们的作用顺序没有被记录下来。这个改动是实现动态相干的关键？
将外部信道嵌入到$n$个更大的信道中，设在第$n$个时间步上(滥用记号$\tilde{A}_n$)，外部信道和控制系统上的映射为
$$
\begin{aligned}
\tilde{A}_n: & =\sum_{\mathcal{K}_{n-1}, k_n} \tilde{A}_{k_n} \otimes\left|\mathcal{K}_{n-1}, k_n\right\rangle^{C_n^{\prime}}\left\langle\mathcal{K}_{n-1},\left.k_n\right|^{C_n}:\right.  \mathsf{H}^{\tilde{A}_n^I C_n} \rightarrow \mathsf{H}^{\tilde{A}_n^O C_n^{\prime}},
\end{aligned}
$$
其蔡氏向量为
$$
\begin{aligned}
   |\tilde{A}_n  \rangle= &   \sum_{\mathcal{K}_{n-1}, k_n} |\tilde{A}_{k_n}  \rangle \otimes |\mathcal{K}_{n-1}, k_n \rangle^{C_n} \otimes |\mathcal{K}_{n-1}, k_n \rangle^{C_n^{\prime}}  \in \mathsf{H}^{\tilde{A}_n^{\prime} C_n A_n C_n^{\prime}}  
\end{aligned}
$$
内部控制会根据控制系统的状态决定作用的幺正变换，内部控制的蔡氏向量的一般形式为
$$
\begin{aligned}
   |\tilde{V}_1  \rangle= &   \sum_{k_1} |\tilde{V}_{\emptyset, \emptyset}^{ \rightarrow k_1}  \rangle \otimes |\emptyset, k_1 \rangle^{C_1} \in \mathsf{H}^{P \tilde{A}_1^I \alpha_1 C_1}, \\
   |\tilde{V}_{n+1}  \rangle= & \sum_{\substack{\mathcal{K}_{n-1}, k_n, k_{n+1}}} |\tilde{V}_{\mathcal{K}_{n-1}, k_n}^{\rightarrow k_{n+1}} \rangle \otimes |\mathcal{K}_{n-1}, k_n \rangle^{C_n^{\prime}}  \otimes |\mathcal{K}_{n-1} \cup k_n, k_{n+1} \rangle^{C_{n+1}}  \in \mathsf{H}^{\tilde{A}_n^o \alpha_n C_n^{\prime} \tilde{A}_{n+1}^I \alpha_{n+1} C_{n+1}}, \\
   |\tilde{V}_{N+1}  \rangle= & \sum_{k_N} |\tilde{V}_{\mathcal{\mathcal { N }} \backslash k_N, k_N}^{ \rightarrow F} \rangle \otimes |\mathcal{N} \backslash k_N, k_N \rangle^{C_N^{\prime}}  \in \tilde{\mathsf{H}}^{\tilde{A}_N^O \alpha_N C_N^{\prime} F \alpha_F}  
\end{aligned}
$$
eq-eq-internalisometry

需要注意指标满足条件$k_n\notin \mathcal{K}_{n-1},k_{n+1}\notin \mathcal{K}_{n-1}\cup k_{n}$。不必在意tilde以及指标重复的问题，这是原作者为了区分$\mathsf{H}^{A_{k_i}}$与$\mathsf{H}^{A_{i}}$而引入的记号，带tilde的符号表示出现在某个特定时刻的Hilbert空间那些不带tilde的空间都与之同构( $|\tilde{V}_{\mathcal{K}_{n-1}, k_n}^{\rightarrow k_{n+1}} \rangle$ 具有两重身份)。上面的蔡氏向量满足特定的保迹(归一化)条件，
$$
\sum_{k_1} \operatorname{Tr}_{A_{k_1}^I \alpha_1}\left|w_{\left(\emptyset, k_1\right)}\right\rangle\left\langle w_{\left(\emptyset, k_1\right)}\right|= \mathbb{I}^P
$$
$$
\begin{aligned}
\forall n & =1, \ldots, N-1, \forall \mathcal{K}_n, \\
&   \sum_{k_{n+1} \notin \mathcal{K}_n} \operatorname{Tr}_{A_{k_{n+1}}^I \alpha_{n+1}} \mid w_{ (\mathcal{K}_n, k_{n+1} )} \rangle \langle w_{ (\mathcal{K}_n, k_{n+1} )} | =  \sum_{k_n \in \mathcal{K}_n} \operatorname{Tr}_{\alpha_n} |w_{ (\mathcal{K}_n \backslash k_n, k_n )} \rangle \langle w_{ (\mathcal{K}_n \backslash k_n, k_n )} | \otimes  \mathbb{I}^{A_{k_n}^O},
\end{aligned}
$$
eq-eq-qcqctpcond
$$
\begin{aligned}
& \operatorname{Tr}_{F \alpha_F} |w_{(\mathcal{N}, F)} \rangle \langle w_{(\mathcal{N}, F)} |    \quad=\sum_{k_N \in \mathcal{N}} \operatorname{Tr}_{\alpha_N} \mid w_{ (\mathcal{N} \backslash k_N, k_N )} \rangle \langle w_{ (\mathcal{N} \backslash k_N, k_N )} | \otimes  \mathbb{I}^{A_{k_N}^O}
\end{aligned}
$$
归一化条件中出现的向量的定义为
$$
\left|w_{\left(\emptyset, k_1\right)}\right\rangle=\left.\left|w_{\left(k_1\right)}\right\rangle=\left|V_{\emptyset, \emptyset}^{\rightarrow k_1}\right\rangle\right\rangle
$$
$$
\left|w_{\left(\mathcal{K}_{n-1}, k_n\right)}\right\rangle\equiv \sum_{\substack{\left(k_1, \ldots, k_{n}\right): \\\left\{k_1, \ldots, k_{n-1}\right\}=\mathcal{K}_{n-1}}}\left|w_{\left(k_1, \ldots, k_{n}\right)}\right\rangle =  \sum_{k_{n-1} \in \mathcal{K}_{n-1}}\left|w_{\left(\mathcal{K}_{n-1} \backslash k_{n-1}, k_{n-1}\right)}\right\rangle *\left|V_{\mathcal{K}_{n-1} \backslash k_{n-1}, k_{n-1}}^{\rightarrow k_{n}}\right\rangle \in \mathsf{H}^{P A_{\mathcal{K}_{n-1}}^{I O} A_{k_n}^I \alpha_n}
$$
$$
\begin{aligned}
& \left.\left.\left|w_{\left(k_1, \ldots, k_n\right)}\right\rangle\equiv \left|V_{\emptyset, \emptyset}^{k_1}\right\rangle\right\rangle *\left|V_{\emptyset, k_1}^{k_2}\right\rangle * \cdots *\left|V_{\left\{k_1, \ldots, k_{n-2}\right\}, k_{n-1}}^{k_{n}}\right\rangle\right\rangle = |w_{(k_1,\cdots,k_{n-1})}\rangle \star |V^{\rightarrow k_n}_{\{ k_1,\ldots ,k_{n-2}\},k_{n-1}} \rangle \in \mathsf{H}^{P A_{\left\{k_1, \ldots, k_{n-1} \right\}}^{I O} A_{k_n}^I \alpha_n},
\end{aligned}
$$
$$
\left|w_{(\mathcal{N}, F)}\right\rangle  \equiv \sum_{\left(k_1, \ldots, k_N\right)} \left|w_{\left(k_1, \ldots, k_N\right)}\right\rangle \star \left|V_{\left\{k_1, \ldots, k_{N-1}\right\}, k_N}^{\rightarrow F}\right\rangle =  \sum_{\left(k_1, \ldots, k_N\right)}\left|w_{\left(k_1, \ldots, k_N, F\right)}\right\rangle
$$
eq-eq-qcqcprocessvec
$$
\begin{aligned}
\left|w_{\left(k_1, \ldots, k_N, F\right)}\right\rangle\equiv  & \left.\left.\left.\left|V_{\emptyset, \emptyset}^{\rightarrow k_1}\right\rangle\right\rangle *\left|V_{\emptyset, k_1}^{\rightarrow k_2}\right\rangle\right\rangle *\left|V_{\left\{k_1\right\}, k_2}^{\rightarrow k_3}\right\rangle\right\rangle  \left.* \cdots *\left|V_{\left\{k_1, \ldots, k_{N-2}\right\}, k_{N-1}}^{k_N}\right\rangle\right\rangle  *\left|V_{\left\{k_1, \ldots, k_{N-1}\right\}, k_N}^{\rightarrow F}\right\rangle \in \mathsf{H}^{P A_{\mathcal{N}}^{I O} F \alpha_F} .
\end{aligned}
$$
如果辅助系统$\alpha_i$是平凡的，那么与其有关的两个操作之间的链积可以改为张量积，即
$$
\left|V_{\{k_1,\cdots,k_{i-2}\},k_{i-1}}^{\rightarrow k_i}\right\rangle  *\left|V_{{\{k_1,\cdots,k_{i-1}\},k_{i}}}^{\rightarrow k_{i+1}}\right\rangle =\left|V_{\{k_1,\cdots,k_{i-2}\},k_{i-1}}^{\rightarrow k_i}\right\rangle  \otimes \left|V_{{\{k_1,\cdots,k_{i-1}\},k_{i}}}^{\rightarrow k_{i+1}}\right\rangle
$$
将蔡氏向量的定义代入到归一化条件式\eqref{eq:qcqctpcond}可得
\begin{figure}[htbp]
 \centering
 \includegraphics[width=0.7\textwidth]{image//2025-06-10-16-37-23.png}
 \caption{因果结构p.25 }
 \label{  }
\end{figure}

利用上面定义的符号，式\eqref{eq:qcqcprocessvec}，QC-QC的过程矩阵是
(这样的过程矩阵有投影刻画吗？)
$$
\begin{aligned}
    W & =\operatorname{Tr}_{\alpha_F}\left|w_{(\mathcal{N}, F)}\right\rangle\left\langle w_{(\mathcal{N}, F)}\right|
    \end{aligned}
$$
eq-eq-qcqcprocesm

式\eqref{eq:qcqcprocesm}中的控制系统已经被缩并了。保迹性条件来自于内部操作$\tilde{V}_i$(式\eqref{eq:internalisometry})的等距性，在构建一个QC-QC时，应该从这一点出发，直接从缩并掉控制系统后的保迹条件出发是很难构造的。
> [!theorem] QC-QC的等价刻画{} （[[mothe2024ReassessingAdvantageIndefinite\|mothe2024ReassessingAdvantageIndefinite]] (24)）
> - 正定矩阵$W$是QC-QC中的元素当且仅当对于任意的$n$，$\mathcal{N}=\{1,\ldots ,N\}$的势为$n-1$任意真子集$\mathcal{K}_{n-1}$，以及任意$k_n\in \mathcal{N} \backslash \mathcal{K}_{n-1}$，存在正定矩阵$W_{\left(\mathcal{K}_{n-1}, k_n\right)} \in B\left(\mathsf{H}^{A_{\mathcal{K}_{n-1}}^{I O} A_{k_n}^I}\right)$，使得特定的保迹条件得到满足
>
$$
\begin{aligned}
& \operatorname{Tr}_F W=\sum_{k_N \in \mathcal{N}} W_{\left(\mathcal{N} \backslash\left\{k_N\right\}, k_N\right)} \otimes \mathbb{I}^{A_{k_N}^O}, \\ & \forall n=1, \ldots, N-1, \forall \emptyset \subsetneq {\mathcal { K } _ { n } \subsetneq \mathcal { N } ,}   \sum_{k_{n+1} \in \mathcal{N} \backslash \mathcal{K}_n} \operatorname{Tr}_{A_{k_{n+1}}^I} W_{\left(\mathcal{K}_n, k_{n+1}\right)}  =\sum_{k_n \in \mathcal{K}_n} W_{\left(\mathcal{K}_n \backslash\left\{k_n\right\}, k_n\right)} \otimes \mathbb{I}_{k_n}, \\
& \sum_{k_1 \in \mathcal{N}} \operatorname{Tr} W_{\left(\emptyset, k_1\right)}=1,  \forall n=1, \ldots, N,\\
& \forall \mathcal{K}_{n-1} \subsetneq \mathcal{N},   \forall k_n \in \mathcal{N} \backslash \mathcal{K}_{n-1}, W_{\left(\mathcal{K}_{n-1}, k_n\right)} \geq 0
\end{aligned}
$$
> [!note]
> - 在上述刻画中，不需要显式出现辅助系统$\alpha_k$。为什么和蔡氏向量的刻画是相反的？

下面的等式[[wechs2021QuantumCircuitsClassical\|wechs2021QuantumCircuitsClassical]](B40)沟通了两种不同的刻画
$$\begin{aligned}
W_{\left(\mathcal{K}_{n-1}, k_n\right)}:= & \operatorname{Tr}_{\alpha_n}\left|w_{\left(\mathcal{K}_{n-1}, k_n\right)}\right\rangle\left\langle w_{\left(\mathcal{K}_{n-1}, k_n\right)}\right| \\
& \in \mathcal{L}\left(\mathcal{H}^{P A_{\mathcal{K}_{n-1}}^{I O} A_{k_n}^I}\right) .
\end{aligned}$$
### 关于QC-QC的问题
嵌套的QC-QC，这是否能够提供更广的不定因果过程？如何对不同类型的QC-QC进行分类，找到其中的标准型，从而为各种任务提供参考？

## 例子
### 例：串联与并联
   最简单的例子是退化为并联和串联情形，并联例在原文中给出\cite[Apd.C]{wechs2021QuantumCircuitsClassical}，串联不知道怎么构造但可以通过把原文\cite[(D1)]{wechs2021QuantumCircuitsClassical}中的第一个操作与恒等置换初态缩并得到，即

$$\left|V_{\emptyset, \emptyset}^{\rightarrow k_1}\right\rangle_{\mathsf{Seq}} = |\mathbb{I}\rangle\rangle^{P_t A_{k_1}^I} \otimes \sum_{\substack{\pi \in \Pi_{\mathcal{N}}: \\ \pi(1)=k_1}}\langle \mathrm{id}|\pi\rangle^{P_c}  \otimes|\pi\rangle^{\alpha_1} = |\mathbb{I}\rangle\rangle^{P_t A_{k_1}^I} \otimes |\mathrm{id}\rangle^{\alpha_1}\delta_{k_1,1}

$$

后续操作保持不变，就能够得到一个串联过程。如果将后续操作也化简，将控制系统$C_n$全部视为1维的，则有

$$ |V_{\mathcal{K}_{n-1},k_n^{\to k_{n+1}}}\rangle_{\mathsf{Seq}}=|\mathbb{I}\rangle _{A_n^O A_{n + 1}^I}\delta_{k_n,n}\delta_{k_{n+1},n+1}\delta_{\mathcal{K}_{n-1},\{1,\cdots,n\}} $$

$$ |\tilde{V}_{\mathcal{\mathcal { N }} \backslash k_N, k_N}^{ \rightarrow F} \rangle_{\mathsf{Seq}}=|\mathbb{I}^{A_{k_N}^OF}\rangle\delta_{k_N,N} $$

每步的等距操作为

$$    \begin{aligned}
   |\tilde{V}_1  \rangle = & |\mathbb{I}\rangle^{PA_1^I} \otimes    |\emptyset, 1 \rangle^{C_1} \in \mathsf{H}^{P \tilde{A}_1^I \alpha_1 C_1}, \\

   |\tilde{V}_{n+1}  \rangle= &  |\mathbb{I} \rangle^{ A_n^O A_{n + 1}^I} \otimes |\{1,\cdots,n - 1\}, n \rangle^{C_n^{\prime}}  \otimes|\{1,\cdots,n \} , {n+1} \rangle^{C_{n+1}}  \in \mathsf{H}^{\tilde{A}_n^o \alpha_n C_n^{\prime} \tilde{A}_{n+1}^I \alpha_{n+1} C_{n+1}}, \\

   |\tilde{V}_{N+1}  \rangle= &  |\mathbb{I} \rangle^{ A_{N^O}F} \otimes   | \{1,\cdots,N - 1\}, N \rangle^{C_N^{\prime}}  \in \tilde{\mathsf{H}}^{\tilde{A}_N^O \alpha_N C_N^{\prime} F \alpha_F}  
\end{aligned}$$

显然上式缩并掉会导致一个平凡的将多个信道复合的过程，这是一个FO过程，这意味着它一定满足QC-QC的保迹条件，但上式并不完全符合QC-QC的原始形式，因为如果仍然认为控制系统是完整的，则对应的$|\tilde{V}_n\rangle$不是等距而是偏等距，根据原文的推导，这些算符只是保持内积，这是偏等距的定义，并没有保证一定是等距，所以偏等距是没有问题的。当缩并掉控制系统之后，似乎可以对等距算符在控制系统上的行为做一些改变而不影响整体的QC-QC，也就是说控制系统实际上存在一些自由度？

好的，我们将给出一个由三方（$A_1, A_2, A_3$）组成的固定顺序过程的例子，并根据您提供的 **Proposition 7 (QC-QC 的等价刻画)** 来严格证明它是一个合法的 QC-QC。==这里的大致思路是没有问题的，但一些细节可能是错误的==。

#### 1. 例子：固定顺序过程 $\pi = (1, 2, 3)$

我们考虑一个最简单的固定顺序过程：一个初始量子态从“过去”（Past, P）输入，依次通过 $A_1$, $A_2$, $A_3$ 三方的操作，最终输出到“未来”（Future, F）。这个过程仅仅是在各方之间传递量子态，因此可以用一系列连接的恒等信道来描述。

其过程矩阵 $W$ 可以表示为这些恒等信道的 Choi 矩阵的张量积（或链式乘积）：
$$
W_{\pi=(1,2,3)} = ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{P A_1^I} \otimes ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{A_1^O A_2^I} \otimes ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{A_2^O A_3^I} \otimes ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{A_3^O F}
$$
其中，$||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{XY}$ 是从希尔伯特空间 $\mathsf{H}^X$ 到 $\mathsf{H}^Y$ 的恒等信道的 Choi 矩阵。为满足命题中的归一化条件，我们假设“过去”空间 $\mathsf{H}^P$ 是一维的，即 $d_P=1$。

#### 2. 证明过程

为了证明 $W_{\pi=(1,2,3)}$ 是一个合法的 QC-QC，我们需要根据 Proposition 7 的要求，构造出一组正定矩阵 $W_{(\mathcal{K}_{n-1}, k_n)}$，并验证它们满足所有的保迹条件。

##### 步骤 1: 构造分解矩阵 $W_{(\mathcal{K}_{n-1}, k_n)}$

由于我们的过程只对应于一个固定的顺序 $(1, 2, 3)$，因此只有沿着这条路径的分解矩阵是非零的。我们定义如下：

*   **对于 n=1:** ($\mathcal{K}_0 = \emptyset$)
    $$
    \begin{aligned}
    W_{(\emptyset, 1)} & := ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{P A_1^I} \\
    W_{(\emptyset, 2)} & := 0 \\
    W_{(\emptyset, 3)} & := 0
    \end{aligned}
    $$
*   **对于 n=2:** ($\mathcal{K}_1 \subset \mathcal{N}$)
    $$
    \begin{aligned}
    W_{(\{1\}, 2)} & := ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{P A_1^I} \otimes ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{A_1^O A_2^I} \\
    W_{(\mathcal{K}_1, k_2)} & := 0 \quad \text{对于所有其他情况}
    \end{aligned}
    $$
*   **对于 n=3:** ($\mathcal{K}_2 \subset \mathcal{N}$)
    $$
    \begin{aligned}
    W_{(\{1,2\}, 3)} & := ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{P A_1^I} \otimes ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{A_1^O A_2^I} \otimes ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{A_2^O A_3^I} \\
    W_{(\mathcal{K}_2, k_3)} & := 0 \quad \text{对于所有其他情况}
    \end{aligned}
    $$

##### 步骤 2: 验证 Proposition 7 的条件

现在我们逐一验证这些构造出的矩阵满足命题中的四个条件。

1.  **正定性条件 ($W_{(\mathcal{K}_{n-1}, k_n)} \geq 0$)**
    我们构造的非零矩阵是 $||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||$ 算子（这是一个秩为1的投影算子）的张量积，因此它们是正定的。零矩阵也是半正定的。此条件满足。

2.  **归一化条件 ($\sum_{k_1 \in \mathcal{N}} \operatorname{Tr} W_{\left(\emptyset, k_1\right)}=1$)**
$$    \begin{aligned}
    \sum_{k_1 \in \{1,2,3\}} \operatorname{Tr} W_{(\emptyset, k_1)} &= \operatorname{Tr}(W_{(\emptyset, 1)}) + \operatorname{Tr}(W_{(\emptyset, 2)}) + \operatorname{Tr}(W_{(\emptyset, 3)}) \\
    &= \operatorname{Tr}_{P A_1^I}(||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{P A_1^I}) + 0 + 0 \\
    &= d_P = 1 \quad (\text{因为我们假设 } d_P=1)
    \end{aligned}$$
    此条件满足。

3.  **顶层条件 ($\operatorname{Tr}_F W=\sum_{k_N \in \mathcal{N}} W_{\left(\mathcal{N} \backslash\left\{k_N\right\}, k_N\right)} \otimes \mathbb{I}^{A_{k_N}^O}$)**
    对于 $N=3$，我们需要验证 $\operatorname{Tr}_F W = \sum_{k_3 \in \{1,2,3\}} W_{(\{1,2,3\}\backslash\{k_3\}, k_3)} \otimes \mathbb{I}^{A_{k_3}^O}$。
    *   **等式左边 (LHS):**
$$        \begin{aligned}
        \operatorname{Tr}_F(W_{\pi=(1,2,3)}) &= \operatorname{Tr}_F\left(||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{P A_1^I} \otimes \dots \otimes ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{A_3^O F}\right) \\
        &= ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{P A_1^I} \otimes ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{A_1^O A_2^I} \otimes ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{A_2^O A_3^I} \otimes \mathbb{I}^{A_3^O}
        \end{aligned}$$
    *   **等式右边 (RHS):**
$$        \begin{aligned}
        \text{RHS} &= W_{(\{1,2\},3)} \otimes \mathbb{I}^{A_3^O} + W_{(\{1,3\},2)} \otimes \mathbb{I}^{A_2^O} + W_{(\{2,3\},1)} \otimes \mathbb{I}^{A_1^O} \\
        &= W_{(\{1,2\},3)} \otimes \mathbb{I}^{A_3^O} + 0 + 0 \\
        &= \left(||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{P A_1^I} \otimes ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{A_1^O A_2^I} \otimes ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{A_2^O A_3^I}\right) \otimes \mathbb{I}^{A_3^O}
        \end{aligned}$$
    LHS = RHS。此条件满足。

4.  **递归条件 ($\forall n=1, \ldots, N-1, \dots$)**
    *   **验证 n=1:** 我们需要验证 $\sum_{k_2 \in \mathcal{N}\backslash\mathcal{K}_1} \operatorname{Tr}_{A_{k_2}^I} W_{(\mathcal{K}_1, k_2)} = \sum_{k_1 \in \mathcal{K}_1} W_{(\mathcal{K}_1\backslash\{k_1\}, k_1)} \otimes \mathbb{I}^{A_{k_1}^O}$。
        *   **情况 1: $\mathcal{K}_1=\{1\}$**
            *   LHS: $\sum_{k_2 \in \{2,3\}} \operatorname{Tr}_{A_{k_2}^I} W_{(\{1\}, k_2)} = \operatorname{Tr}_{A_2^I} W_{(\{1\}, 2)} + \operatorname{Tr}_{A_3^I} W_{(\{1\}, 3)} = \operatorname{Tr}_{A_2^I} W_{(\{1\}, 2)} + 0 = ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{P A_1^I} \otimes \mathbb{I}^{A_1^O}$.
            *   RHS: $\sum_{k_1 \in \{1\}} W_{(\emptyset, k_1)} \otimes \mathbb{I}^{A_{k_1}^O} = W_{(\emptyset, 1)} \otimes \mathbb{I}^{A_1^O} = ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{P A_1^I} \otimes \mathbb{I}^{A_1^O}$.
            *   LHS = RHS。
        *   **情况 2: $\mathcal{K}_1=\{2\}$ 或 $\mathcal{K}_1=\{3\}$**
            *   LHS: 因为所有 $W_{(\{2\},\cdot)}$ 和 $W_{(\{3\},\cdot)}$ 均为零，所以 LHS = 0。
            *   RHS: 因为 $W_{(\emptyset, 2)}$ 和 $W_{(\emptyset, 3)}$ 均为零，所以 RHS = 0。
            *   LHS = RHS。
    *   **验证 n=2:** 我们需要验证 $\sum_{k_3 \in \mathcal{N}\backslash\mathcal{K}_2} \operatorname{Tr}_{A_{k_3}^I} W_{(\mathcal{K}_2, k_3)} = \sum_{k_2 \in \mathcal{K}_2} W_{(\mathcal{K}_2\backslash\{k_2\}, k_2)} \otimes \mathbb{I}^{A_{k_2}^O}$。
        *   **情况 1: $\mathcal{K}_2=\{1,2\}$**
            *   LHS: $\sum_{k_3 \in \{3\}} \operatorname{Tr}_{A_{k_3}^I} W_{(\{1,2\}, k_3)} = \operatorname{Tr}_{A_3^I} W_{(\{1,2\}, 3)} = ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{P A_1^I} \otimes ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{A_1^O A_2^I} \otimes \mathbb{I}^{A_2^O}$.
            *   RHS: $\sum_{k_2 \in \{1,2\}} W_{(\{1,2\}\backslash\{k_2\}, k_2)} \otimes \mathbb{I}^{A_{k_2}^O} = W_{(\{2\}, 1)} \otimes \mathbb{I}^{A_1^O} + W_{(\{1\}, 2)} \otimes \mathbb{I}^{A_2^O} = 0 + W_{(\{1\}, 2)} \otimes \mathbb{I}^{A_2^O} = ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{P A_1^I} \otimes ||\mathbb{I}\rangle\rangle\langle\langle\mathbb{I}||^{A_1^O A_2^I} \otimes \mathbb{I}^{A_2^O}$.
            *   LHS = RHS。
        *   **情况 2: $\mathcal{K}_2=\{1,3\}$ 或 $\mathcal{K}_2=\{2,3\}$**
            *   LHS: 所有相关的 $W$ 矩阵均为零，LHS = 0。
            *   RHS: 所有相关的 $W$ 矩阵均为零，RHS = 0。
            *   LHS = RHS。

所有递归条件均满足。

### 例：两路的量子开关
> [!example] 两路的量子开关
> - 以第\ref{ex:quantumswitch}小节的量子开关为例，它的过程矩阵的蔡氏向量中的每一项都写为
>
$$
\begin{aligned}
\left.\left|V_{\emptyset, \emptyset}^{\rightarrow k_1}\right\rangle\right\rangle & =| \mathbb{I}\rangle\rangle^{P_t A_{k_1}^I} \otimes\left|k_1\right\rangle^{P_c}, \\
\left.\left|V_{\emptyset, k_1}^{\rightarrow k_2}\right\rangle\right\rangle & =| \mathbb{I}\rangle\rangle^{A_{k_1}^O A_{k_2}^I}, \\
\left.\left|V_{\left\{k_1\right\}, k_2}^F\right\rangle\right\rangle & =| \mathbb{I}\rangle\rangle^{A_{k_2}^O F_t} \otimes\left|k_1\right\rangle^{F_c} .
\end{aligned}
$$
>   根据式\eqref{eq:qcqcprocessvec}，我们要把所有可能的顺序相干地叠加起来得到量子开关的过程矩阵的蔡氏向量
>
$$
\begin{aligned}
|w_{\mathsf{DS}} \rangle=        |1\rangle^{P_c}| \mathbb{I} \rangle^{P_t A_1^I}| \mathbb{I} \rangle^{A_1^O A_2^I}| \mathbb{I} \rangle^{A_2^O F_t}|1\rangle^{F_c}       +|2\rangle^{P_c}| \mathbb{I} \rangle^{P_t A_2^I}| \mathbb{I} \rangle^{A_2^O A_1^I}| \mathbb{I} \rangle^{A_1^O F_t}|2\rangle^{F_c}  \in \mathcal{H}^{P_c P_t A_1^{I O} A_2^{I O} F_t F_c},
\end{aligned}
$$
### 例：一个只有部分记忆的量子开关
> [!example] ~一个只有部分记忆的量子开关
> - 如果希望每个外部系统之间的操作是恒等操作，但又要保持每个时间步上的变换是等距的，就不可避免地引入一些辅助系统(我只在必要的时候引入辅助系统)，这最终导致了一个特殊的量子开关，它的行为完全可以通过在\eqref{eq:qsarbinput}中取合适的初态来实现。
>
$$
\begin{aligned}
& \left|V^{\rightarrow k_1}\right\rangle=|\mathbb{I}\rangle^{P A_{k_1}^I}\left|k_1\right\rangle^{P_c} \\
& \left|V^{\rightarrow k_2}\right\rangle=\frac{1}{\sqrt{2}}|\mathbb{I}\rangle^{A_{k_1}^O A_{k_3}^I} \\
& \left|V^{\rightarrow k_3}\right\rangle=|\mathbb{I}\rangle^{A_{k_1}^O A_{k_3}^I}\left|k_2\right\rangle^{\alpha_3} \\
& \left|V^{\rightarrow F}\right\rangle=|\mathbb{I}\rangle^{A_{k_3}^O F}\left|k_3\right\rangle^{F_c}|\mathbb{I}\rangle^{\alpha_3 \alpha_F}
\end{aligned}
$$
>
>   最终的蔡氏向量为
>
$$
\left|w_{(\mathcal{N}, F)}\right\rangle=\sum_{\left(k_1, k_2, k_3\right)} \frac{1}{\sqrt{2}}\left|\mathbb{I}^3\right\rangle^{P A_1 A_2 A_3 F}\left|k_1\right\rangle^{P_c}\left|k_2\right\rangle^{\alpha_F}\left|k_3\right\rangle^{F_c}
$$
>
>   这是一个只接受3维控制输入的量子开关，如果接受控制系统上的一个初态$\frac{1}{\sqrt{3}} |\psi\rangle^{P_c}=\sum_{k_1} |k_1\rangle$，那么它就会等效为一个等权重叠加的量子开关。其构建过程如下图：
>   \begin{figure}[htbp]
>   \centering
>   \includegraphics[width=0.7\textwidth]{image//2025-07-08-10-50-57.png}
>   \caption{因果结构p.28}
>   \label{  }
>   \end{figure}
>   
>   重复类似的推导，可以得到一些没有完整记忆的$N$体量子开关(待补充)，基本方法是如果控制系统的维度在变大，我们可以丢掉记忆并引入一个因子来保证保迹性(例如$\tilde{V}_2$)，如果控制系统的维度在减小，则引入辅助系统来保证单时间步算符的等距性(例如$\tilde{V}_3$和例如$\tilde{V}_4$)。而多体且拥有完整记忆的量子开关的构建参考（[[wechs2021QuantumCircuitsClassical\|wechs2021QuantumCircuitsClassical]] (D1)），这需要引入更多辅助系统，记忆之前的外部系统调用顺序。在受控系统上进行一些非等距的操作似乎是取得动态控制的必要条件。

### 动态相干控制的三路开关
> [!example] 动态相干控制的三路开关
> - 相干、动态的顺序叠加的等效比特信道（[[wechs2021QuantumCircuitsClassical\|wechs2021QuantumCircuitsClassical]] (67)）。
>
$$
\begin{aligned}
& V_{\emptyset, \emptyset}^{ \rightarrow k_1}=\frac{1}{\sqrt{3}}|\psi\rangle^{A_{k_1}^I}, \\
& V_{\emptyset, k_1}^{ \rightarrow k_2}= \left\{\begin{array}{lll}
|0\rangle^{A_{k_2}^I} \langle   0 |^{A_{k_1}^O}   & \text { if } k_2=k_1+1 & (\bmod 3)  \\
|1\rangle^{A_{k_2}^I} \langle   1 |^{A_{k_1}^O}   & \text { if } k_2=k_1+2 & (\bmod 3)
\end{array}, \right. \\
& V_{ \{k_1 \}, k_2}^{ \rightarrow k_3}= \left\{\begin{array}{ll}
|0\rangle^{A_{k_3}^I}|0\rangle^{\alpha_3} \langle   0 |^{A_{k_2}^O}+\mid 1 \rangle^{A_{k_3}^I}|1\rangle^{\alpha_3} \langle   1 |^{A_{k_2}^O}   & \text { if } k_2=k_1+1 \quad(\bmod 3) \\
|0\rangle^{A_{k_3}^I}|1\rangle^{\alpha_3} \langle   0 |^{A_{k_2}^O}+\mid 1 \rangle^{A_{k_3}^I}|0\rangle^{\alpha_3} \langle   1 |^{A_{k_2}^O}   & \text { if } k_2=k_1+2 \quad(\bmod 3)
\end{array},  \right. \\
& V_{ \{k_1, k_2 \}, k_3}^{\rightarrow F}=\mathbb{I}^{A_{k_3}^O \alpha_3  \rightarrow \alpha_F^{(1)}} \otimes |k_3 \rangle^{\alpha_F^{(2)}},
\end{aligned}
$$
>
>   eq-eq-truethreeswitch



>   $\alpha^{(1)}_F = F_t \alpha_F ,\alpha^{(2)}_F=F_c$。
>
>   修改式\eqref{eq:truethreeswitch}，显式地加入输入和输出空间，假设$P$和$F$都是单比特空间，
>
$$
\begin{aligned}
& V_{\emptyset, \emptyset}^{ \rightarrow k_1}=\frac{1}{\sqrt{3}}\mathbb{I}^{P\rightarrow A_{k_1}^I}, \\
& V_{\emptyset, k_1}^{ \rightarrow k_2}= \left\{\begin{array}{lll}
|0\rangle^{A_{k_2}^I} \langle   0 |^{A_{k_1}^O}   & \text { if } k_2=k_1+1 & (\bmod 3)  \\
|1\rangle^{A_{k_2}^I} \langle   1 |^{A_{k_1}^O}   & \text { if } k_2=k_1+2 & (\bmod 3)
\end{array}, \right. \\
& V_{ \{k_1 \}, k_2}^{ \rightarrow k_3}= \left\{\begin{array}{ll}
|0\rangle^{A_{k_3}^I}|0\rangle^{\alpha_3} \langle   0 |^{A_{k_2}^O}+\mid 1 \rangle^{A_{k_3}^I}|1\rangle^{\alpha_3} \langle   1 |^{A_{k_2}^O}   & \text { if } k_2=k_1+1 \quad(\bmod 3) \\
|0\rangle^{A_{k_3}^I}|1\rangle^{\alpha_3} \langle   0 |^{A_{k_2}^O}+\mid 1 \rangle^{A_{k_3}^I}|0\rangle^{\alpha_3} \langle   1 |^{A_{k_2}^O}   & \text { if } k_2=k_1+2 \quad(\bmod 3)
\end{array},  \right. \\
& V_{ \{k_1, k_2 \}, k_3}^F=\mathbb{I}^{A_{k_3}^O \alpha_3  \rightarrow F^t \alpha_F } \otimes |k_3 \rangle^{F^c},
\end{aligned}
$$
>   


>   其中，输出空间的辅助系统为$\alpha_F$，是比特系统，输出空间$F$由两部分组成，$F=F^cF^t$，$F^c$是三维系统，$F^t$是比特系统。更进一步的推广是
>
$$
\begin{aligned}
&V_{\emptyset, \emptyset}^{\rightarrow k_1}:=\mathbb{I}^{P_t \rightarrow A_{k_1}^I} \otimes\left\langle\left. k_1\right|^{P_c},\right.\\
&V_{\emptyset, k_1}^{\rightarrow k_2}:=\left(\mathbb{I}^{A_{k_2}^I} \otimes\left\langle\left.\sigma_{\left(k_1, k_2\right)}\right|^\alpha\right) \mathcal{V}_{k_1},\right.\\
& V_{\left\{k_1\right\}, k_2}^{\rightarrow k_3}:=\mathcal{V}_{k_3}^{\prime}\left(\mathbb{I}^{A_{k_2}^O} \otimes\left|\sigma_{\left(k_1, k_2\right)}\right\rangle^{\alpha^{\prime}}\right),\\
& V_{\left\{k_1, k_2\right\}, k_3}^{\rightarrow F }:=\mathbb{I}^{A_{k_3}^O \rightarrow F_t} \otimes \mathbb{I}^{\alpha_3 \rightarrow \alpha_F} \otimes\left|k_3\right\rangle^{F_c} .
\end{aligned}
$$
>
>   eq-eq-generalizedthreeswitch


>   其中 $\mathcal{V}_{k_1}: \mathcal{H}^{A_{k_1}^O} \rightarrow \mathcal{H}^{A_{k_2}^I \alpha},\mathcal{V}_{k_3}^{\prime}: \mathcal{H}^{A_{k_2}^O \alpha^{\prime}} \rightarrow \mathcal{H}^{A_{k_3}^I \alpha_3}$，$P^c$是三维系统，受控系统$P_t ,F_t$的相同维度而任意。$\sigma_{\left(k_1, k_2\right)}=0 \text { if } k_2=k_1+1(\bmod 3)$，$\sigma_{\left(k_1, k_2\right)}=1 \text { if } k_2=k_1+2(\bmod 3)$。构造这类过程的关键在于要满足保迹性条件，可以检验保迹性。
>
>
> -
$$
\sum_{k_1} \text{tr}_{A_{k_1}^I} | w_{(\emptyset,k_1)}\rangle \langle  w_{(\emptyset,k_1)}| = \sum_{k_1} \text{tr}_{A_{k_1}^I} |V_{\emptyset,\emptyset}^{\to k_1}\rangle \langle V_{\emptyset,\emptyset}^{\to k_1}|
$$
>
$$
= \sum_{k_1} \text{tr}_{A_{k_1}^I} |\mathbb{I}\rangle \langle \mathbb{I}|_{P_t A_{k_1}^I} \otimes |k_1\rangle \langle k_1|_{P_c} = \mathbb{I}_{P_t} \otimes \mathbb{I}_{P_c} = \mathbb{I}_P.
$$
> - 大小为1的集合有3种可能的选取方式 \($\mathcal{K}_1 = \{1 \}, \{2 \}, \{3 \}$\)
>
$$
| w_{(\mathcal{K}_1,k_2)}\rangle = \sum_{k_1 \in \mathcal{K}_1} | w_{(k_1,k_2)}\rangle = | w_{(k_1,k_2)}\rangle \otimes |V_{\emptyset,k_1}^{\to k_2}\rangle, k_1 \in \mathcal{K}_1
$$
>
>   利用双矢量公式，有
>
$$
|V_{\emptyset,k_1}^{\to k_2}\rangle_{A_{k_1}^OA_{k_2}^I} = \mathbb{I}_{A_{k_1}^I} \otimes \langle \sigma_{(k_1,k_2)}|_\alpha \otimes \mathbb{I}_{A_{k_1}^O} |V_{k_1}\rangle_{A_{k_2}^I \alpha A_{k_1}^I} = \langle \sigma_{(k_1,k_2)}| \mathcal{V}_{k_1}\rangle_{A_{k_2}^I A_{k_1}^O}
$$
>
>
$$
\sum_{k_2 \notin \mathcal{K}_1} \text{tr}_{A_{k_2}^I} | w_{(\mathcal{K}_1,k_2)}\rangle \langle  w_{(\mathcal{K}_1,k_2)}| = | w_{(k_1)}\rangle \langle  w_{(k_1)}| \otimes \sum_{k_2 \notin \mathcal{K}_1} \text{tr}_{A_{k_2}^I} |V_{\emptyset,k_1}^{\to k_2}\rangle \langle V_{\emptyset,k_1}^{\to k_2}|
$$
>
$$
= | w_{(k_1)}\rangle \langle  w_{(k_1)}| \otimes \sum_{k_2} \text{tr}_{A_{k_2}^I} \langle \sigma_{(k_1,k_2)}| \mathcal{V}_{k_1}\rangle \langle \mathcal{V}_{k_1}| \sigma_{(k_1,k_2)} \rangle
$$
>
$$
= | w_{(k_1)}\rangle \langle  w_{(k_1)}| \otimes \text{tr}_{A_{k_2}^I\alpha } | \mathcal{V}_{k_1}\rangle \langle \mathcal{V}_{k_1}|
$$
>
$$
= | w_{(1)}\rangle \langle  w_{(1)}| \left( \text{tr}_{A_2^I} \langle 0 | \mathcal{V}_1\rangle \langle \mathcal{V}_1| 0\rangle + \text{tr}_{A_3^I} \langle 1| \mathcal{V}_1\rangle \langle \mathcal{V}_1| 1\rangle \right), \text{ 当 }k_1 = 1, k_2 = 2,3
$$
>
$$
= | w_{(1)}\rangle \langle  w_{(1)}| \otimes \mathbb{I}_{A_1^o}
$$
>   当\(k_1\)取其它值时也有类似结果。添加辅助系统的意义就是利用不同系统上的内积和trace得到对$\mathcal{V}_{k_1}$的蔡氏矩阵的输出空间的trace，从而得到$A_{k_1}^O$上的单位阵。


$\mathcal{K}_2=\{12 \}, \{2 3\}, \{13 \}$
>
$$
\begin{aligned}
&\sum_{k_3 \notin \mathcal{K}_2} \text{tr}_{A_{k_3}^I \alpha_3} | w_{(\mathcal{K}_2, k_3)}\rangle \langle  w_{(\mathcal{K}_2, k_3)}| \\
=& \sum_{k_3 \notin \mathcal{K}_2} \text{tr}_{A_{k_3}^I \alpha_3} \sum_{k_2, q_2 \in \mathcal{K}_2} | w_{(\mathcal{K}_2 \setminus \{k_2\}, k_2)}\rangle \langle  w_{(\mathcal{K}_2 \setminus \{q_2\}, q_2)}| \otimes |V_{\mathcal{K}_2 \setminus \{k_2\}, k_2}^{\to k_3}\rangle \langle V_{\mathcal{K}_2 \setminus \{q_2\}, q_2}^{\to k_3}| \\
=& \sum_{k_2, q_2 \in \mathcal{K}_2} | w_{(\mathcal{K}_2 \setminus \{k_2\}, k_2)}\rangle \langle  w_{(\mathcal{K}_2 \setminus \{q_2\}, q_2)}| \otimes \text{tr}_{A_{k_3}^I \alpha_3} |V_{\mathcal{K}_2 \setminus \{k_2\}, k_2}^{\to k_3}\rangle \langle V_{\mathcal{K}_2 \setminus \{q_2\}, q_2}^{\to k_3}| \quad (1)
\end{aligned}
$$
>   利用双矢量公式，有
>
$$
|V_{\mathcal{K}_2 \setminus \{k_2\}, k_2}^{\to k_3}\rangle = (\mathbb{I}_{A_{k_2}^O}\otimes \mathcal{V}_{k_3}^\prime   ) |\mathbb{I}\rangle_{A_{k_2}^O A_{k_2}^O} \otimes |\sigma_{(k_1, k_2)}\rangle_{\alpha'}
$$
>
$$
\text{tr}_{A_{k_3}^I \alpha_3} |V_{\mathcal{K}_2 \setminus \{k_2\}, k_2}^{\to k_3}\rangle \langle V_{\mathcal{K}_2 \setminus \{q_2\}, q_2}^{\to k_3}| = \sum_{ij} \text{tr}_{A_{k_3}^I \alpha_3} (\mathcal{V}_{k_3}' |i\rangle \langle j|_{A_{k_2}^o} \otimes |\sigma_{(\mathcal{K}_2 \setminus \{k_2\}, k_2)}\rangle \langle \sigma_{(\mathcal{K}_2 \setminus \{q_2\}, q_2)}|_{\alpha^\prime } \mathcal{V}_{k_3}^{\prime \dagger }) \otimes |i\rangle \langle j|_{A_{k_2}^o}
$$
>
$$
= \delta_{k_2 q_2} \mathbb{I}_{A_{k_2}^o} \quad (2)
$$
>   综合 (1), (2)，有
>
$$
\sum_{k_3 \notin \mathcal{K}_2} \text{tr}_{A_{k_3}^I \alpha_3} | w_{(\mathcal{K}_2, k_3)}\rangle \langle  w_{(\mathcal{K}_2, k_3)}| = \sum_{k_2 \in \mathcal{K}_2} | w_{(\mathcal{K}_2 \setminus \{k_2\}, k_2)}\rangle \langle  w_{(\mathcal{K}_2 \setminus \{q_2\}, q_2)}| \otimes \mathbb{I}_{A_{k_2}^o}
$$

最后一步
>  $$ \begin{align*}
>
>
>
>   &| w_{(\mathcal{N},F)}\rangle=\sum_{k_1,k_2,k_3}| w_{(k_1,k_2,k_3)}\rangle\star|V_{\{k_1,k_2\},k_3}^{\to F}\rangle=\sum|V_{\emptyset ,\emptyset}^{\to k_1}\rangle\otimes|V_{\emptyset,k_1}^{\to k_2}\rangle\otimes|V_{\{k_1\},k_2}^{\to k_3}\rangle\star|V_{\{k_1,k_2\},k_3}^{\to F}\rangle\\
>   =& \sum|V_{\emptyset,\emptyset}^{\to k_1}\rangle\otimes|V_{\emptyset,k_1}^{\to k_2}\rangle\otimes|V_{\{k_1\},k_2}^{\to k_3}\rangle|\mathbb{I}\rangle_{A_{k_3}^O F_t}|k_3\rangle_{F_c}\\
>   =& \sum_{k_3}\sum_{k_1k_2}| w_{(k_1,k_2,k_3)}\rangle|\mathbb{I}\rangle|k_3\rangle \\
>   =&\sum_{k_3} | w_{(\mathcal{N}\setminus  k_3,k_3)}\rangle|\mathbb{I}\rangle|k_3\rangle\,
>   \end{align*}$$
>   上式已经利用了
>
$$
| w_{(\mathcal{N}\setminus  k_3,k_3)}\rangle=\sum_{k_1k_2}| w_{(k_1,k_2,k_3)}\rangle=\sum_{k_1k_2}|V_{\emptyset,\emptyset}^{\to k_1}\rangle\star|V_{\emptyset,k_1}^{\to k_2}\rangle\star|V_{\{k_1,k_2\}}^{\to k_3}\rangle
$$
>   以及
>
$$
\begin{aligned}
\left|V_{\{k_1\}, k_2}^{\rightarrow k_3}\right\rangle *\left|V_{\left\{k_1, k_2\right\}, k_3}^{\rightarrow F}\right\rangle & =\left(\left|V_{\left\{k_1\right\}, k_2}^{\rightarrow k_3}\right\rangle_{A_{k_3}^I \alpha_3 A_{k_2}^O}^{T_{\alpha_3}} \otimes \mathbb{I}_{F_t F_c \alpha_F}\right)\left(|\mathbb{I}\rangle_{A_{k_3}^O F_t} \otimes|\mathbb{I}\rangle_{\alpha_3 \alpha_F} \otimes\left|k_3\right\rangle_{F_c}\right) \\
& =\mathbb{I}^{\alpha_3 \rightarrow \alpha_F}\left|V_{\left\{k_1\right\}, k_2}^{\rightarrow k_3}\right\rangle_{A_{k_3}^I \alpha_3 A_{k_2}^O}|\mathbb{I}\rangle_{A_{k_3}^O F_t}\left|k_3\right\rangle_{F_c}
\end{aligned}
$$
>   保迹条件写为
>  $$ \begin{align*}
   &\mathrm{tr}_{F\alpha_F}| w(\mathcal{N},F)\rangle\langle  w(\mathcal{N},F)|=\mathrm{tr}_{F\alpha_F}\left(\sum_{k_3,q_3} | w_{(\mathcal{N}\setminus  k_3,k_3)}\rangle\langle  w_{(\mathcal{N}\setminus  q_3,q_3)}| \otimes|\mathbb{I}\rangle_{A_{k_3}^OF_t}\langle\mathbb{I}|\otimes|k_3\rangle_{F_c}\langle q_3|\right)\\
   =&\mathrm{tr}_{\alpha_F}| w_{(\mathcal{N}\setminus  k_3,k_3)}\rangle\langle  w_{(\mathcal{N}\setminus  q_3,q_3)}|\otimes\mathbb{I}_{A_{k_3}^O}\otimes\delta_{k_3q_3}\\
   =&\mathrm{tr}_{\alpha_F}| w_{(\mathcal{N}\setminus  k_3,k_3)}\rangle\langle  w_{(\mathcal{N}\setminus  k_3,k_3)}|\otimes\mathbb{I}_{A_{k_3}^O}
   \end{align*}$$
>   



>   
>  一个更具启发性且更简单的过程保迹性检验方式是利用$V_n$的等距性：
>
> -
$$
\begin{aligned}
|\widetilde{V}_1\rangle &= \sum_{k_1} |\mathbb{I}\rangle^{P_t A_{k_1}^I} |k_1\rangle^{P_c} | \phi, k_1 \rangle^{C_1},\\
\mathrm{tr}_{A_1^IC_1}  | \widetilde{V}_1 \rangle\langle \widetilde{V}_1|&= \mathbb{I}_{P_t}\otimes \mathbb{I}_{P_c}\otimes \mathbb{I}_{C_1}
\end{aligned}
$$
> -
$$
\begin{aligned}
|\widetilde{V}_2\rangle &= \sum_{ k_1 k_2 k_3} \langle \sigma_{(k_1,k_2)}| \mathcal{V}_{k_1}\rangle_{A_{k_2}^I A_{k_1}^O}  | \phi, k_2 \rangle^{C_1'} |\{k_1\}, k_2\rangle^{C_2}, \\
\mathrm{tr}_{A_2^I}  | \widetilde{V}_2 \rangle\langle \widetilde{V}_2| &= \sum_{(k_1,k_2) \atop (q_1,q_2)} \mathrm{tr}_{A_2^I}\langle \sigma_{(k_1,k_2)} | \mathcal{V}_1\rangle \langle \mathcal{V}_1 | \sigma_{(q_1,q_2)} \rangle | \phi, k_1 \rangle\langle \phi, q_1 |^{C_1'} \mathrm{tr}|\{k_1\}, k_2\rangle\langle\{q_1\}, q_2|^{C_2} \\
&= \mathbb{I}_{A_1^o} \otimes \mathbb{I}_{C_1'}.
\end{aligned}
$$
> -
$$
\begin{aligned}
|V_3\rangle &= \sum_{k_1,k_2,k_3} \mathbb{I}_{A_3^o} \otimes \mathcal{V}_3^\prime  |\mathbb{I}\rangle_{A_3^o A_3^o} |\sigma_{(k_1,k_2)}\rangle^{\alpha'} |\{k_1\}, k_2\rangle^{C_2^\prime} |\{k_1,k_2\}, k_3\rangle^{C_3}, \\
\mathrm{tr}_{\alpha_2A_3^I C_3} | \widetilde{V}_3 \rangle\langle \widetilde{V}_3|  &= \sum_{\{k,k_2\} \atop =\{q_1,q_2\}} \mathrm{tr}_{\alpha_3 A_3^I} \left( \mathbb{I}_{A_3^o} \otimes \mathcal{V}_3^\prime  \right) |\mathbb{I}\rangle_{\alpha_3^o A_3^o} \otimes |\sigma_{(k,k_2)}\rangle_{\alpha'} \langle \mathbb{I} |_{\alpha_3^o A_3^o} \langle \sigma_{(q_1,q_2)} | \left( \mathbb{I}_{A_3^o} \otimes \mathcal{V}_3^{\prime\dagger} \right) \otimes |\{k_1\}, k_2\rangle\langle\{q_1\}, q_2| \\
&= \sum_{\{k_1,k_2\} \atop =\{q_1,q_1\}} |i\rangle\langle j| \otimes \mathrm{tr}\left(\mathcal{V}_3^\prime  |i\rangle\langle j|  \otimes   \left| \sigma_{(k_1,k_2)} \right\rangle   \langle \sigma_{(q_1,q_2)} | \mathcal{V}_3^{\prime\dagger}\right) \otimes |\{k_1\}, k_2\rangle\langle\{q_1\}, q_2| \\
&= \mathbb{I}_{A_2^o} \sum_{\{k_1,k_2\} \atop =\{q_1,q_2\}} \langle \sigma_{(q_1,q_2)} | \sigma_{(k_1,k_2)} \rangle |\{k_1\}, k_2\rangle\langle\{q_1\}, q_2| \\
&= \mathbb{I}_{A_2^o} \otimes \mathbb{I}_{C_2'}.
\end{aligned}
$$
> -
$$
\begin{aligned}
|\widetilde{V}_4\rangle &= \sum_{k_3} |V\rangle^{P_t} \otimes |\{k_1,k_2\}, k_3\rangle^{C_3'}, \\
&= |\mathbb{I}\rangle^{A_2^o F_t} \otimes |\mathbb{I}\rangle \sum_{k_3} |k_3\rangle^{F_c} |\{k_1,k_2\}, k_3\rangle^{C_3'}, \\
\mathrm{tr}_{\alpha_F F_c} |V^4\rangle\langle V^4| &= \mathbb{I}_{A_3^o} \otimes \mathbb{I}_{\alpha_3} \otimes \mathbb{I}_{C_3'}.
\end{aligned}
$$
>
>
>   式\eqref{eq:generalizedthreeswitch}组合成一个动态开关(dynamical switch)，如果取初态控制系统为均匀叠加态$|\psi\rangle _{P_c} = \frac{1}{\sqrt{3}}(|0\rangle +|1\rangle +|2\rangle)$，两个等距算符分别为COPY和CNOT，则蔡氏向量为
>
$$
|w_{\mathsf{DS}}\rangle =  \sum_{(k_1,k_2,k_3)} |V_{\emptyset, \emptyset}^{\rightarrow k_1} \rangle   * |V_{\emptyset, k_1}^{\rightarrow k_2} \rangle   * |V_{ \{k_1 \}, k_2}^{\rightarrow k_3} \rangle      * |V_{ \{k_1,  k_{2} \}, k_3}^{\rightarrow F} \rangle
$$
>   求和项数为6，显式给出求和结果的表达式参见QC-QC计算.nb-无输入，保留输出α2F1。插入三个完全退极化信道(QC-QC计算.nb-插入完全退极化信道，解析方法求偏迹)
>
$$
\begin{aligned}
&    |w_{\mathsf{DS}}\rangle \langle w_{\mathsf{DS}}| \star  \rho^\mathsf{Dp} \star  \rho^\mathsf{Dp} \star  \rho^\mathsf{Dp} \\
=   &8 (\frac{1}{2}  (\mathbb{I}_{P_tF_tF_cP_c} - \mathbb{I}_{P_tF_t}\otimes\sum_{i = 1}^{3}|i\rangle\langle i|_{F_c} |i\rangle \langle i|_{P_c}  )\\ &+
|00\rangle\langle00|\otimes(|\psi^1\rangle\langle\psi^1|-(|01\rangle\langle01| + |12\rangle\langle 12|+|20\rangle\langle20|)) \\& +|11\rangle\langle 11|\otimes(|\psi^2\rangle\langle\psi^2|-(|02\rangle\langle02| + |10\rangle\langle 10|+|21\rangle\langle21|))  )\\
&|\psi^1\rangle = |01\rangle+|12\rangle + |20\rangle\\
&|\psi^2\rangle = |02\rangle+|10\rangle+|12\rangle
\end{aligned}
$$
>
>   插入三个完全退极化信道后，得到等效信道(QC-QC计算.nb-给定控制系统初态)
>
$$
\begin{aligned}
& \rho^{\mathsf{DS}_{\mathrm{eff}}}=|\psi\rangle _{P_c}\langle \psi| \star |w_{\mathsf{DS}}\rangle \langle w_{\mathsf{DS}}| \star  \rho^\mathsf{Dp} \star  \rho^\mathsf{Dp} \star  \rho^\mathsf{Dp} \\  = & \frac{1}{8}\left( (|0 0\rangle\langle 0 0|+|1 1\rangle\langle 1 1|)_{P_t F_t}\otimes|\psi\rangle\langle\psi|_{F_c}+(\mathbb{I}_{P_t F_t}+\frac{1}{3}|0 1\rangle\langle 0 1|+|1 0\rangle\langle 1 0|)\otimes\mathbb{I}_{F_c} \right)
\end{aligned}
$$
>   上面的解析表达式只对均匀叠加态$|\psi\rangle =\frac{1}{\sqrt{3}}(|0\rangle +|1\rangle +|2\rangle)$成立。
>
>   将未来的控制比特系统trace掉将得到完全退极化信道
>
$$
\mathrm{tr}_{F_c}(\rho^{\mathsf{DS}_{\mathrm{eff}}}) = \frac{\mathbb{I}_{P_t  F_t}}{2}
$$
>   是否存在一些过程，它被插入一些完全退极化信道且将辅助系统求迹之后得到的等效信道不是完全退极化的？当然是存在的，这完全取决于辅助系统的定义，信息可以在辅助系统中传递，而不经过完全退极化信道。
>
>   这个等效信道看上去性能不太好，尝试其他的选择，最理想的情形是确定最优化的目标，给出最优化算法，对特定的问题找到最优通信策略。将CNOT改为恒等信道，则式\eqref{eq:generalizedthreeswitch}的中间两式成为
>
$$
\begin{aligned}
& V_{\emptyset, k_1}^{ \rightarrow k_2}= \left\{\begin{array}{lll}
|0\rangle^{A_{k_2}^I} \langle   0 |^{A_{k_1}^O}   & \text { if } k_2=k_1+1 & (\bmod 3)  \\
|1\rangle^{A_{k_2}^I} \langle   1 |^{A_{k_1}^O}   & \text { if } k_2=k_1+2 & (\bmod 3)
\end{array}, \right. \\
& V_{ \{k_1 \}, k_2}^{ \rightarrow k_3}= \left\{\begin{array}{ll}
|0\rangle^{A_{k_3}^I}|0\rangle^{\alpha_3} \langle   0 |^{A_{k_2}^O}+\mid 1 \rangle^{A_{k_3}^I}|0\rangle^{\alpha_3} \langle   1 |^{A_{k_2}^O}   & \text { if } k_2=k_1+1 \quad(\bmod 3) \\
|0\rangle^{A_{k_3}^I}|1\rangle^{\alpha_3} \langle   0 |^{A_{k_2}^O}+\mid 1 \rangle^{A_{k_3}^I}|1\rangle^{\alpha_3} \langle   1 |^{A_{k_2}^O}   & \text { if } k_2=k_1+2 \quad(\bmod 3)
\end{array},  \right. \\
\end{aligned}
$$
>
>   eq-eq-truethreeswitch


### 例：动态相干控制的四体和N体开关

> [!example] 动态相干控制的$4$体开关I——推广原文的三体开关
> -
$$
\begin{aligned}
V_{\emptyset, \emptyset}^{\rightarrow k_1}&=\mathbb{I}^{P_t \rightarrow A_{k_1}^I} \otimes\left\langle\left. k_1\right|^{P_c},\right.\\
V_{\emptyset, k_1}^{\rightarrow k_2} &=\left(\mathbb{I}^{A_{k_2}^I} \otimes\left\langle\left.\sigma_{\left(k_1, k_2\right)}\right|^\alpha\right) \mathcal{V}_{k_1}^{(1)},\right.\\
V_{\left\{k_1\right\}, k_2}^{\rightarrow k_3}& =\mathcal{V}_{k_3}^{(3)}\left(\mathbb{I}^{A_{k_2}^O} \otimes\left|\sigma_{\left(k_1, k_2\right)}\right\rangle^{\alpha^{\prime}}\right),\\
V_{\{k_1, k_2\}, k_3} ^{\to k_4} &= \left( \mathcal{V}_{k_4}^{(4)} \left( \mathbb{I}^{A_{k_3}^O} \otimes \left| \theta(\{k_1, k_2\}, k_3) \right\rangle^{\alpha_4^{(1)\prime}} \right) \right) \otimes \mathbb{I}^{\alpha_3 \to \alpha_4^{(2)}}  \\
V_{\{k_1, k_2, k_3\}, k_4} ^{\to F} &= \mathbb{I}^{A_{k_4}^O \to F} \otimes \mathbb{I}^{\alpha_4^{(1)\prime} \alpha_4^{(2)} \to \alpha_F} \otimes\left| k_4 \right\rangle^{F_c}
\end{aligned}
$$
>   其中
>   $\mathcal{V}_{k_4}^{(4)}  : A_{k_3}^O \alpha_4^{(1)'} \to A_{k_4}^I \alpha_4^{(1)}$，$\mathcal{V}_{k_1}^{(1)}: \mathcal{H}^{A_{k_1}^O} \rightarrow \mathcal{H}^{A_{k_2}^I \alpha},\mathcal{V}_{k_3}^{\prime}: \mathcal{H}^{A_{k_2}^O \alpha^{\prime}} \rightarrow \mathcal{H}^{A_{k_3}^I \alpha_3}$是任意等距算符，$\alpha_4^{(1)}$是三维辅助系统




$$
\theta(\{k_1, k_2\}, k_3) =
\begin{cases}
0 & \text{if } (k_1, k_2), k_3 \text{ corresponds to } (1,2), 3; \ (1,2), 4; \ (1,3), 4; \ (3,4), 2 \\
1 & \text{if } (k_1, k_2), k_3 \text{ corresponds to } (1,3), 2; \ (2,4), 1; \ (3,4), 1; \ (2,3), 4 \\
2 & \text{if } (k_1, k_2), k_3 \text{ corresponds to } (2,3), 1; \ (1,4), 2; \ (1,4), 3; \ (2,4), 3
\end{cases}
$$
>
>   eq-eq-def_controltheta



>   而$\sigma$的定义与之前类似，
$$
\sigma(k_1, k_2) =
\begin{cases}
0 & \text{if } k_2 = k_1 + 1 \pmod{4} \\
1 & \text{if } k_2 = k_1 + 2 \pmod{4} \\
2 & \text{if } k_2 = k_1 + 3 \pmod{4}
\end{cases}
$$

前三个算符的等距性与3体开关类似，只检验$V_4$的等距性，
$$   \begin{align*}
  & \mathrm{tr}_{\alpha_4 A_4^I} \left( \left| \widetilde{V}_4 \right> \left< \widetilde{V}_4 \right| \right) \\
  &= \sum_{\substack{\{k_1, k_2\}, k_3 \\ \{q_1, q_2\}, q_3 \\ \{k_1, k_2, k_3\} = \{q_1, q_2, q_3\}}} |i\rangle\left< j \right| \mathrm{tr} \left({\mathcal{V}_{k_4}^{(4)}}  \left| i \right> \left< j \right| \otimes \left| \theta(\{k_1, k_2\}, k_3) \right> \left< \theta(\{q_1, q_2\}, q_3) \right| \mathcal{V}_{k_4}^{\prime \dagger}\right) \left| \{k_1, k_2\}, k_3 \right> \left< \{q_1, q_2\}, q_3 \right| \otimes |\mathbb{I}\rangle \left\langle \mathbb{I} \right| \\
  &= \sum \mathbb{I}_{A_3^o} \mathbb{I}_{\alpha_3} \left< \theta(\{k_1, k_2\}, k_3) \right| \left. \theta(\{q_1, q_2\}, q_3) \right> \left| \{k_1, k_2\}, k_3 \right> \left< \{q_1, q_2\}, q_3 \right| \\
  &= \sum \mathbb{I}_{A_3^o} \mathbb{I}_{\alpha_3} \delta_{k_3 q_3} \delta_{\{k_1, k_2\}, \{q_1, q_2\}} \left| \{k_1, k_2\}, k_3 \right> \left< \{q_1, q_2\}, q_3 \right| \\
  &= \mathbb{I}_{A_3^o} \mathbb{I}_{\alpha_3} \mathbb{I}_{C^3}
  \end{align*}$$


  
  引入新的辅助系统以及等距算符然后取得等距性的关键在于$\theta$的设计。在式\eqref{eq:def_controltheta}的每一行中，即
>   $\theta$的每一个取值中，只有 $\{k_1, k_2, k_3\} = \{q_1, q_2, q_3\}$的交叉项会出现，因此可以使得  $\left\langle \theta(\{k_1, k_2\}, k_3) \right| \theta(\{q_1, q_2\}, q_3) \rangle = \delta_{k_3q_3}\delta_{\{k_1,k_2\},\{q_1,q_2\}}$成立。$\theta$定义中的每一列可以任意交换，不影响等距性。


> [!example] 动态相干控制的$4$体开关II——简易版本(希望不会退回到平凡情形)
> -
$$
\begin{aligned}
V_{\emptyset, \emptyset}^{\rightarrow k_1}&=\mathbb{I}^{P_t \rightarrow A_{k_1}^I} \otimes\left\langle\left. k_1\right|^{P_c},\right.\\
V_{\emptyset, k_1}^{\rightarrow k_2} &= \mathcal{V}_{k_2}^{(2)}\\
V_{\left\{k_1\right\}, k_2}^{\rightarrow k_3}& =\mathcal{V}_{k_3}^{(3)}\left(\mathbb{I}^{A_{k_2}^O} \otimes\left|\sigma_{\left(k_1, k_2\right)}\right\rangle^{\alpha_3^{\prime}}\right),\\
V_{\{k_1, k_2\}, k_3} ^{\to k_4} &= \left( \mathcal{V}_{k_4}^{(4)} \left( \mathbb{I}^{A_{k_3}^O} \otimes \left| \theta(\{k_1, k_2\}, k_3) \right\rangle^{\alpha_4^{\prime}} \right) \right) \otimes \mathbb{I}^{\alpha_3 \to \beta_3}  \\
V_{\{k_1, k_2, k_3\}, k_4} ^{\to F} &= \mathbb{I}^{A_{k_4}^O \to F} \otimes \mathbb{I}^{\alpha_4^{(1) } \alpha_4^{(2)} \to \alpha_F} \otimes\left| k_4 \right\rangle^{F_c}
\end{aligned}
$$
> [!example] 动态相干控制的$N$体开关
> -
$$
\begin{aligned}
V_{\emptyset, \emptyset}^{\rightarrow k_1}&=\mathbb{I}^{P_t \rightarrow A_{k_1}^I} \otimes\left\langle\left. k_1\right|^{P_c},\right.\\
V_{\emptyset, k_1}^{\rightarrow k_2} &=\frac{1}{\sqrt{N-1}} \mathcal{V}_{k_2}^{(2)}\\
V_{ \{ k_1, \ldots, k_{n-1} \} , k_n }^{ \to k_{n+1} }&  = \left( \mathcal{V}_{k_{n+1}}^{ (n+1) } \left( \mathbb{I}^{A_{k_n}^o} \otimes |\sigma^{ (n-1) } \left( \{ k_1, \ldots, k_{n-1} \}, k_n \right)\rangle^{ \beta_{n+1}' }  \right) \right) \otimes \mathbb{I} ^{\alpha_n \to  \gamma_n},~n=2,\ldots ,N-1\\
V_{ \{ k_1, \ldots, k_{N-1} \} , k_N }^{\to {F}}&  = \mathbb{I}^{A_{k_N}^{O} \to F} \otimes \mathbb{I}^{\alpha_N \rightarrow F} \otimes |k_N\rangle ^{F_c}
\end{aligned}
$$
>   其中$\mathcal{V}_{k_{n }}^{ (n ) }: A_{k_{n }}^o\beta_{n }^\prime   \to A_{k_{n }}^I \beta_{n },~n=3,\ldots ,N$，辅助系统$\alpha_{n+1}=\beta_n\gamma_n \simeq \beta_n\alpha_n$，$\mathrm{dim}  \beta_n = n-1$。
>   辅助系统中的$\sigma^{(n-1)}$定义如下，定义集合$S_{\mathcal{K}_n}=\{(\{k_1,\ldots,k_{n-1}\},k_n )| \{k_1,\ldots,k_{n-1}\} \cup k_n = \mathcal{K}_n\}$，共有$\binom{N}{n}$个不同的集合$S_{\mathcal{K}_n}$，显然他们两两交集为空，满足$\{(\{k_1,\ldots,k_{n-1}\},k_n) \} = \bigcup_{\mathcal{K}_n} S_{\mathcal{K}_n}$，且对于任意的${\mathcal{K}_n}$，$|S_{\mathcal{K}_n}|=n$，即$|S_{\mathcal{K}_n}|$中有$n$个元素。$\sigma^{(n-1)}: \bigcup_{\mathcal{K}_n} S_{\mathcal{K}_n} \to \{1,\ldots,n\}$只需要满足$\sigma^{(n-1)}|_{S_{\mathcal{K}_n}}$是单射即可。这可以保证下面的保迹条件。
>
$$
\begin{aligned}
|\widetilde{V}_{n+1}\rangle
&= \sum_{k_{n-1}, k_n, k_{n+1}} \mathbb{I}_{A_{n+1}^o} \otimes \widetilde{V}_{n+1} |\mathbb{I}\rangle_{A_{n+1}^o A_{n+1}^o} \left| \sigma^{(n-1)} \left( \{k_1, \ldots, k_{n-1}\}, k_n \right) \right\rangle^{\beta_{n+1}'}
|\{k_1, \ldots, k_{n+1}\}, k_n\rangle^{C_{n-1}} |\{k_1, \ldots, k_n\}, k_{n+1}\rangle^{C_n} |\mathbb{I}\rangle^{\alpha_n \gamma_n} \\
\mathrm{tr} \left( |\widetilde{V}^{n+1}\rangle \langle \widetilde{V}^{n+1}| \right)  & = \mathbb{I}_{\alpha_n} \mathbb{I}_{A_{n+1}^o} \sum \langle \sigma^{(n-1)}( \{k_1, \ldots, k_{n-1}\}, k_n) | \sigma^{(n-1)} (\{q_1, \ldots, q_{n-1}\}, q_n )\rangle  |\{k_1, \ldots, k_{n-1}\}, k_n \rangle \langle q_1, \ldots, q_{n-1}, q_n| \\
& = \mathbb{I}_{\alpha_n} \mathbb{I}_{A_{n+1}^o} \mathbb{I}_{C_n}
\end{aligned}
$$
>
>   这个开关与$N$-SWICH的主要区别是辅助系统是逐个引入的，而不是预先确定的(还没搞清楚到底是不是同一个过程)。

## 高阶量子过程

### 多轮过程矩阵 
参考{[[hoffreumon2021MultiroundProcessMatrix\|hoffreumon2021MultiroundProcessMatrix]],[[hoffreumonProcessesIndefiniteCausal\|hoffreumonProcessesIndefiniteCausal]],[[perinotti2017CausalStructuresClassification\|perinotti2017CausalStructuresClassification]],[[wilson2021CausalityHigherOrder\|wilson2021CausalityHigherOrder]],[[bisio2019TheoreticalFrameworkHigherorder\|bisio2019TheoreticalFrameworkHigherorder]],[[castro-ruiz2018DynamicsQuantumCausal\|castro-ruiz2018DynamicsQuantumCausal]],[[renner2017TimePhysics\|renner2017TimePhysics]]}。多轮过程矩阵(MPM)用于描述多个有确定因果顺序的观测者与环境的相互作用，这个模型可以用于多个量子梳的精密测量模型。

模仿归一化过程矩阵的定义，我们不预先假定各个comb之间存在因果关系，只要求这些comb和过程矩阵结合在一起以后满足一定的概率归一化条件，则有下面的定义。
> [!definition] 多轮过程矩阵
> - \label{def:multiroundporcessmat}
>   $W^{AB\cdots}$是多轮过程矩阵，如果
>
$$
\begin{aligned}
&W^{A B \cdots} \geq 0\\
&\operatorname{tr}\left[W^{A B \ldots} \cdot\left(M^A \otimes M^B \cdots\right)\right]=1
\end{aligned}
$$
>
>   任取量子梳$M^A,M^B,\ldots$。

> [!note]
> - 根据线性性可以看出， 归一化条件等价于$W$在comb的任意仿射组合上归一化。

用投影方法可以给出多轮过程矩阵的等价刻画。
> [!theorem] 多轮过程矩阵的投影刻画{} （[[hoffreumon2021MultiroundProcessMatrix\|hoffreumon2021MultiroundProcessMatrix]] Th.1）
> - 设梳$n_X$个齿的$\sigma_X$对应的投影算符为$\mathcal{P}_{n_X}^X$，则输入和输出平凡的正定矩阵$W\equiv W^{X_1\cdots X_N}$是合法的
>
$$
\mathcal{P} \equiv \bigotimes_{X \in \mathfrak{N}} \mathcal{P}_{n_X}^X
$$
>
>
>   ($\cdots$)

> [!note]
> - 对这个定理中的梳取特殊情况，可以得到\eqref{eq:2pointprocess}。> [!abstract] Contents
> - 无

不定因果过程，尤其是量子开关，在经典以及量子传输任务中被视为一种特殊的资源。应用层面的策略设计通常以经典信道容量(由信道的Holevo信息量定义)、量子信道容量[[chiribella2021IndefiniteCausalOrder\|chiribella2021IndefiniteCausalOrder]](由信道的量子相干信息定义)以及保真度为优化目标，而更基础的策略则专注于定义不定因果版本的上述三个目标本身。我还未清楚如果要考虑一般的不定因果过程对量子信息传输的增益需要加入什么样的约束限制，尤其是对辅助空间和控制-受控系统纠缠之间的约束。
## 量子开关
在量子信息中被研究最多的不定因果模型是量子开关。量子开关可以推广到多个信道。仍然记为$\hat{X}=|W\rangle\langle W |$，仿照式\eqref{eq:choivecofqs}直接写出推广后的蔡氏向量，
$$
|W\rangle =\sum_\pi |\pi\pi\rangle_{Q^\prime Q^*} |\mathbb{I}\rangle^{\otimes N+1} _{S^*A^{\pi(1)}\cdots A^{\pi(N)}S^\prime}
$$
仿照式\eqref{eq:mixswitchchoiplugged}中的推导，可得插入了信道$\mathcal{A}^k=\{ E_{i_k}^k \}$之后的等效信道的蔡氏矩阵为
$$
|W\rangle\langle W| \star \rho^{\mathcal{A}^1}\star\cdots \star \rho^{\mathcal{A}^N} = \sum_{i_1\ldots i_N}|\theta_{i_1\ldots i_N}\rangle \langle \theta_{i_1\ldots i_N}|
$$
$$
|\theta_{i_1\ldots i_N} \rangle  = \sum_\pi |\pi\pi\rangle | E_{i_{\pi(1)}}^{\pi(1)}\cdots E_{i_{\pi(N)}}^{\pi(N)} \rangle
$$
Kraus算符为
$$
\theta_{i_1\ldots i_N} = \sum_\pi |\pi\rangle \langle \pi |\otimes E_{i_{\pi(1)}}^{\pi(1)}\cdots E_{i_{\pi(N)}}^{\pi(N)}
$$
如果只插入控制比特$|s\rangle _{Q^\prime }=\sum_\pi s_\pi |\pi \rangle$，而不插入信道可得
$$
|W\rangle \langle W|\star |s\rangle \langle s|  = |W,s\rangle \langle W,s|
$$
根据式\eqref{eq:choiveclinkproduct}
$$
|W,s\rangle  = |W\rangle ^{\top_Q} (\mathbb{I}\otimes |s\rangle ) = \sum_\pi s_\pi|\pi \rangle _{Q^\prime } |\mathbb{I}\rangle^{\otimes N+1} _{S^*A^{\pi(1)}\cdots A^{\pi(N)}S^\prime}
$$
完全退极化信道的蔡氏矩阵正比于单位阵，$\rho^\mathsf{Dp}=\frac{\mathbb{I}}{d}$，如果插入的$N$个信道都是完全退极化信道，那么得到的等效过程为(符号偏迹.nb)
$$
\begin{aligned}
        & \hat{X}^\mathsf{Dp}=|W,s\rangle\langle W,s| \star \rho^{\mathsf{Dp}}\star\cdots \star \rho^{\mathsf{Dp}} 
         =    \frac{1}{d^N}\mathrm{tr}_{ A^1\cdots A^N } \left(|W,s\rangle\langle W,s|\right)=    \frac{1}{d^N}\mathrm{tr}_{ A} \left(|W,s\rangle\langle W,s|\right)\\ 
         = & \frac{1}{d^N}\sum s_\pi s_\theta^*|\pi\rangle\langle\theta| \otimes\mathrm{tr}_{ A }\left|i_1 i_1 \cdots i_{N+1} i_{N+1}\right\rangle\left\langle j_j j_1 \cdots j_{N+1} j_{N+1}\right| \in B\left(S \otimes A^{\theta(1)} \otimes \cdots \otimes A^{\theta(N)} \otimes S^{\prime}, S \otimes A^{\pi(1)} \otimes \cdots \otimes A^{\pi (N)} \otimes S^{\prime}\right) \\
= & \frac{1}{d^N}\sum s_\pi s_\theta^*|\pi\rangle\langle\theta| \otimes\mathrm{tr}_{ A }\left|i_1 i_{\pi^{-1}(1)} i_{\pi^{-1}(1)+1} \cdots i_{\pi^{-1}(N)+1} i_{N+1}\right\rangle\left\langle j_1 j_{\theta^{-1}(1)} \cdots j_{\theta^{-1}(N)+1} j_{N+1}\right| \in B\left(S \otimes A^{1} \otimes \cdots \otimes A^N \otimes S^{\prime}\right) \\
= &\frac{1}{d^N} \sum s_\pi s_\theta^*|\pi\rangle\langle\theta| \otimes\left|i_1 i_{N+1}\right\rangle\left\langle j_1 j_{N+1}\right| \prod_{k=1}^N \delta_{i_{\pi^{-1}(k)} j_{\theta^{-1}(k)}}\delta_{i_{\pi^{-1}(k) + 1} j_{\theta^{-1}(k) + 1}} \\ 
= &\frac{1}{d^N} \sum s_\pi s_\theta^*|\pi\rangle\langle\theta| \otimes\left|i_1 i_{N+1}\right\rangle\left\langle j_1 j_{N+1}\right| \prod_{m}\delta_{i_{\pi^{-1}(\theta(m))} j_{\pi^{-1}(\theta(m))}}\delta_{i_{\pi^{-1}(\theta(m)) + 1} j_{\pi^{-1}(\theta(m)) + 1}} \\ 
= &\frac{1}{d^N} \sum s_\pi s_\theta^*|\pi\rangle\langle\theta| \otimes\left|i_1 i_{N+1}\right\rangle\left\langle j_1 j_{N+1}\right| \prod_{m}\delta_{i_{\alpha(m)} j_{\alpha(m)}}\delta_{i_{\alpha(m) + 1} j_{\alpha(m) + 1}}\quad \text{定义 } \alpha = \pi^{ - 1}\circ \theta \\ 
= &\frac{1}{d^N} \sum s_\pi s_\theta^*|\pi\rangle\langle\theta| \otimes\left|i_1 i_{N+1}\right\rangle\left\langle i_{\alpha(1)} i_{\alpha(N) + 1 }\right| \prod_{m = 1}^{N - 1 }\delta_{i_{\alpha(m) + 1} i_{\alpha(m + 1)}}  \\ 
= &\frac{1}{d^N} \sum s_\pi s_\theta^*|\pi\rangle\langle\theta| \otimes\left|i_1 i_{N+1}\right\rangle\left\langle i_{\alpha(1)} i_{\alpha(N) + 1 }\right| \delta_{i_{\alpha(1) + 1}i_{\alpha(2)}} \delta_{i_{\alpha(2) + 1}i_{\alpha(3)}}\cdots \delta_{i_{\alpha(N- 1) + 1}i_{\alpha(N)}} \\ 
 = &\frac{1}{d^N} \sum s_\pi s_\theta^*|\pi\rangle\langle\theta| \otimes R_\alpha 
    \end{aligned}
$$
对每一项用$\alpha$定义一张无向图，顶点是出现在$\prod_{m = 1}^{N - 1 }\delta_{i_{\alpha(m) + 1} i_{\alpha(m + 1)}}$中的指标下标，每个因子代表一条边 ，仍然记为$\alpha$，$c_\alpha$代表$\alpha$中圈的数量(利用图论化简表达式.nb)。$R_\alpha$有公式
$$
R_\alpha = 
\begin{cases}
d^{c_\alpha} \mathbb{I},
&1 \overset{\alpha}{\sim} N+1
 \\[6pt]
d^{c_\alpha}\,\lvert \mathbb{I}\rangle\langle \mathbb{I} \rvert,
&1 \not\!\overset{\alpha}{\sim} N+1
\end{cases}
$$
所有可能的$\alpha$的集合记为$A_{|s\rangle}$，它由初态确定，
$$
A_{|s\rangle} =\{ \alpha\mid \alpha = \pi^{-1}\circ \theta, \langle \pi |s\rangle \neq 0 , \langle \theta |s\rangle \neq 0\}
$$
根据$\hat{X}^\mathsf{Dp}$的正定性可知，$\alpha \in A _{|s\rangle }$等价于$\alpha^{-1} \in A _{|s\rangle }$。对应的信道的经典容量容易计算吗？在不等相位的情况下能否算出Holevo量？将控制比特投影到特定的态上，然后计算得到的受控比特的Fidelity，实现所谓的量子通信。是否有更好的量来刻画？例如量子信道容量？

如果只有循环置换，则$\alpha(1)\neq 1$意味着$\alpha(n)\neq n ,\forall n$，上式可以化简为
$$
\hat{X}^\mathsf{Dp}= \frac{1}{d}\sum_\pi |s_\pi|^2 |\pi\rangle \langle \pi | \otimes \mathbb{I} +\frac{1}{d^2}\sum_{\theta\neq \pi } s_\pi s_\theta^*|\pi\rangle\langle\theta| \otimes |\mathbb{I}\rangle\langle \mathbb{I}|
$$
只需要注意到在循环置换中，$\alpha(1)=\alpha(N)+1$以及
$$
\sum_{\{i_{2},\ldots ,i_{N}\}-i_{\alpha(1)}}\prod_{m = 1}^{N - 1 }\delta_{i_{\alpha(m) + 1} i_{\alpha(m + 1)}}  = \delta_{i_1i_{N+1}} d^{N-2}
$$
讨论多体相互通信，是否可以使用其他的常见多体过程？

做QC-QC推广(QC-QC计算.nb)。

# 松散的内容
- [[2 项目笔记/不定因果/不定因果×量子纠错\|不定因果×量子纠错]]
- [[2 项目笔记/不定因果/不定因果×量子通信\|不定因果×量子通信]]
	- [[1 Stories of Bizzo's Life/5 量子科学和量子技术/不定因果/不定因果与量子通信综述\|不定因果与量子通信综述]]
- [[1 Stories of Bizzo's Life/5 量子科学和量子技术/不定因果/不定因果新方向分析\|不定因果新方向分析]]
- [[2 项目笔记/不定因果/不定因果与量子计算\|不定因果与量子计算]]
- [[2 项目笔记/不定因果/不定因果基础理论研究\|不定因果基础理论研究]]
- [[不定因果×量子精密测量\|不定因果×量子精密测量]]
- 不定因果的时间尺度是多少？是否越长的不定顺序越难以实现？是否有m级甚至km级的量子开关？